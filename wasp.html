
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>WASP Reference Manual &#8212; WASP-OS  documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Roadmap" href="TODO.html" />
    <link rel="prev" title="Application Writer’s Guide" href="appguide.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="wasp-reference-manual">
<span id="id1"></span><h1>WASP Reference Manual<a class="headerlink" href="#wasp-reference-manual" title="Permalink to this headline">¶</a></h1>
<div class="section" id="module-wasp">
<span id="system-management"></span><h2>System management<a class="headerlink" href="#module-wasp" title="Permalink to this headline">¶</a></h2>
<p>WASP system management (including constants)</p>
<dl class="data">
<dt>
<code class="sig-name descname">system = Manager()</code></dt>
<dd><p>system is the system-wide instance of the Manager class. Applications
can use this instance to access system services.</p>
</dd></dl>

<dl class="class">
<dt id="wasp.EventMask">
<em class="property">class </em><code class="sig-prename descclassname">wasp.</code><code class="sig-name descname">EventMask</code><a class="headerlink" href="#wasp.EventMask" title="Permalink to this definition">¶</a></dt>
<dd><p>Enumerated event masks.</p>
<dl class="attribute">
<dt id="wasp.EventMask.BUTTON">
<code class="sig-name descname">BUTTON</code><em class="property"> = 8</em><a class="headerlink" href="#wasp.EventMask.BUTTON" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="wasp.EventMask.SWIPE_LEFTRIGHT">
<code class="sig-name descname">SWIPE_LEFTRIGHT</code><em class="property"> = 2</em><a class="headerlink" href="#wasp.EventMask.SWIPE_LEFTRIGHT" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="wasp.EventMask.SWIPE_UPDOWN">
<code class="sig-name descname">SWIPE_UPDOWN</code><em class="property"> = 4</em><a class="headerlink" href="#wasp.EventMask.SWIPE_UPDOWN" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="wasp.EventMask.TOUCH">
<code class="sig-name descname">TOUCH</code><em class="property"> = 1</em><a class="headerlink" href="#wasp.EventMask.TOUCH" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="wasp.EventType">
<em class="property">class </em><code class="sig-prename descclassname">wasp.</code><code class="sig-name descname">EventType</code><a class="headerlink" href="#wasp.EventType" title="Permalink to this definition">¶</a></dt>
<dd><p>Enumerated interface actions.</p>
<p>MicroPython does not implement the enum module so EventType
is simply a regular object which acts as a namespace.</p>
<dl class="attribute">
<dt id="wasp.EventType.BACK">
<code class="sig-name descname">BACK</code><em class="property"> = 257</em><a class="headerlink" href="#wasp.EventType.BACK" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="wasp.EventType.DOWN">
<code class="sig-name descname">DOWN</code><em class="property"> = 1</em><a class="headerlink" href="#wasp.EventType.DOWN" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="wasp.EventType.HOME">
<code class="sig-name descname">HOME</code><em class="property"> = 256</em><a class="headerlink" href="#wasp.EventType.HOME" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="wasp.EventType.LEFT">
<code class="sig-name descname">LEFT</code><em class="property"> = 3</em><a class="headerlink" href="#wasp.EventType.LEFT" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="wasp.EventType.RIGHT">
<code class="sig-name descname">RIGHT</code><em class="property"> = 4</em><a class="headerlink" href="#wasp.EventType.RIGHT" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="wasp.EventType.TOUCH">
<code class="sig-name descname">TOUCH</code><em class="property"> = 5</em><a class="headerlink" href="#wasp.EventType.TOUCH" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="wasp.EventType.UP">
<code class="sig-name descname">UP</code><em class="property"> = 2</em><a class="headerlink" href="#wasp.EventType.UP" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="wasp.Manager">
<em class="property">class </em><code class="sig-prename descclassname">wasp.</code><code class="sig-name descname">Manager</code><a class="headerlink" href="#wasp.Manager" title="Permalink to this definition">¶</a></dt>
<dd><p>WASP system manager</p>
<p>The manager is responsible for handling top-level UI events and
dispatching them to the foreground application. It also provides
services to the application.</p>
<p>The manager is expected to have a single system-wide instance
which can be accessed via <code class="xref py py-data docutils literal notranslate"><span class="pre">wasp.system</span></code> .</p>
<dl class="method">
<dt id="wasp.Manager.brightness">
<em class="property">property </em><code class="sig-name descname">brightness</code><a class="headerlink" href="#wasp.Manager.brightness" title="Permalink to this definition">¶</a></dt>
<dd><p>Cached copy of the brightness current written to the hardware.</p>
</dd></dl>

<dl class="method">
<dt id="wasp.Manager.keep_awake">
<code class="sig-name descname">keep_awake</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wasp.Manager.keep_awake" title="Permalink to this definition">¶</a></dt>
<dd><p>Reset the keep awake timer.</p>
</dd></dl>

<dl class="method">
<dt id="wasp.Manager.navigate">
<code class="sig-name descname">navigate</code><span class="sig-paren">(</span><em class="sig-param">direction=None</em><span class="sig-paren">)</span><a class="headerlink" href="#wasp.Manager.navigate" title="Permalink to this definition">¶</a></dt>
<dd><p>Navigate to a new application.</p>
<p>Left/right navigation is used to switch between applications in the
quick application ring. Applications on the ring are not permitted
to subscribe to :py:data`EventMask.SWIPE_LEFTRIGHT` events.</p>
<p>Swipe up is used to bring up the launcher. Clock applications are not
permitted to subscribe to :py:data`EventMask.SWIPE_UPDOWN` events since
they should expect to be the default application (and is important that
we can trigger the launcher from the default application).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>direction</strong> (<em>int</em>) – The direction of the navigation</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="wasp.Manager.register">
<code class="sig-name descname">register</code><span class="sig-paren">(</span><em class="sig-param">app</em>, <em class="sig-param">quick_ring=False</em><span class="sig-paren">)</span><a class="headerlink" href="#wasp.Manager.register" title="Permalink to this definition">¶</a></dt>
<dd><p>Register an application with the system.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>app</strong> (<em>object</em>) – The application to regsister</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="wasp.Manager.request_event">
<code class="sig-name descname">request_event</code><span class="sig-paren">(</span><em class="sig-param">event_mask</em><span class="sig-paren">)</span><a class="headerlink" href="#wasp.Manager.request_event" title="Permalink to this definition">¶</a></dt>
<dd><p>Subscribe to events.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>event_mask</strong> (<em>int</em>) – The set of events to subscribe to.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="wasp.Manager.request_tick">
<code class="sig-name descname">request_tick</code><span class="sig-paren">(</span><em class="sig-param">period_ms=None</em><span class="sig-paren">)</span><a class="headerlink" href="#wasp.Manager.request_tick" title="Permalink to this definition">¶</a></dt>
<dd><p>Request (and subscribe to) a periodic tick event.</p>
<p>Note: With the current simplistic timer implementation sub-second
tick intervals are not possible.</p>
</dd></dl>

<dl class="method">
<dt id="wasp.Manager.run">
<code class="sig-name descname">run</code><span class="sig-paren">(</span><em class="sig-param">no_except=True</em><span class="sig-paren">)</span><a class="headerlink" href="#wasp.Manager.run" title="Permalink to this definition">¶</a></dt>
<dd><p>Run the system manager synchronously.</p>
<p>This allows all watch management activities to handle in the
normal execution context meaning any exceptions and other problems
can be observed interactively via the console.</p>
</dd></dl>

<dl class="method">
<dt id="wasp.Manager.sleep">
<code class="sig-name descname">sleep</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wasp.Manager.sleep" title="Permalink to this definition">¶</a></dt>
<dd><p>Enter the deepest sleep state possible.</p>
</dd></dl>

<dl class="method">
<dt id="wasp.Manager.switch">
<code class="sig-name descname">switch</code><span class="sig-paren">(</span><em class="sig-param">app</em><span class="sig-paren">)</span><a class="headerlink" href="#wasp.Manager.switch" title="Permalink to this definition">¶</a></dt>
<dd><p>Switch to the requested application.</p>
</dd></dl>

<dl class="method">
<dt id="wasp.Manager.wake">
<code class="sig-name descname">wake</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wasp.Manager.wake" title="Permalink to this definition">¶</a></dt>
<dd><p>Return to a running state.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="wasp.PinHandler">
<em class="property">class </em><code class="sig-prename descclassname">wasp.</code><code class="sig-name descname">PinHandler</code><span class="sig-paren">(</span><em class="sig-param">pin</em><span class="sig-paren">)</span><a class="headerlink" href="#wasp.PinHandler" title="Permalink to this definition">¶</a></dt>
<dd><p>Pin (and Signal) event generator.</p>
<p>TODO: Currently this driver doesn’t actually implement any
debounce but it will!</p>
<dl class="method">
<dt id="wasp.PinHandler.get_event">
<code class="sig-name descname">get_event</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wasp.PinHandler.get_event" title="Permalink to this definition">¶</a></dt>
<dd><p>Receive a pin change event.</p>
<p>Check for a pending pin change event and, if an event is pending,
return it.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>boolean of the pin state if an event is received, None
otherwise.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-apps.clock">
<span id="applications"></span><h2>Applications<a class="headerlink" href="#module-apps.clock" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="apps.clock.ClockApp">
<em class="property">class </em><code class="sig-prename descclassname">apps.clock.</code><code class="sig-name descname">ClockApp</code><a class="headerlink" href="#apps.clock.ClockApp" title="Permalink to this definition">¶</a></dt>
<dd><p>Simple digital clock application.</p>
<p>Shows a time (as HH:MM) together with a battery meter and the date.</p>
<dl class="attribute">
<dt id="apps.clock.ClockApp.ICON">
<code class="sig-name descname">ICON</code><em class="property"> = 'Default digital clock icon'</em><a class="headerlink" href="#apps.clock.ClockApp.ICON" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="apps.clock.ClockApp.NAME">
<code class="sig-name descname">NAME</code><em class="property"> = 'Clock'</em><a class="headerlink" href="#apps.clock.ClockApp.NAME" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="apps.clock.ClockApp.draw">
<code class="sig-name descname">draw</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#apps.clock.ClockApp.draw" title="Permalink to this definition">¶</a></dt>
<dd><p>Redraw the display from scratch.</p>
</dd></dl>

<dl class="method">
<dt id="apps.clock.ClockApp.foreground">
<code class="sig-name descname">foreground</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#apps.clock.ClockApp.foreground" title="Permalink to this definition">¶</a></dt>
<dd><p>Activate the application.</p>
</dd></dl>

<dl class="method">
<dt id="apps.clock.ClockApp.sleep">
<code class="sig-name descname">sleep</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#apps.clock.ClockApp.sleep" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="apps.clock.ClockApp.tick">
<code class="sig-name descname">tick</code><span class="sig-paren">(</span><em class="sig-param">ticks</em><span class="sig-paren">)</span><a class="headerlink" href="#apps.clock.ClockApp.tick" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="apps.clock.ClockApp.update">
<code class="sig-name descname">update</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#apps.clock.ClockApp.update" title="Permalink to this definition">¶</a></dt>
<dd><p>Update the display (if needed).</p>
<p>The updates are a lazy as possible and rely on an prior call to
draw() to ensure the screen is suitably prepared.</p>
</dd></dl>

<dl class="method">
<dt id="apps.clock.ClockApp.wake">
<code class="sig-name descname">wake</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#apps.clock.ClockApp.wake" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<span class="target" id="module-apps.flashlight"></span><dl class="class">
<dt id="apps.flashlight.FlashlightApp">
<em class="property">class </em><code class="sig-prename descclassname">apps.flashlight.</code><code class="sig-name descname">FlashlightApp</code><a class="headerlink" href="#apps.flashlight.FlashlightApp" title="Permalink to this definition">¶</a></dt>
<dd><p>Trivial flashlight application.</p>
<p>Shows a pure white screen with the backlight set to maximum.</p>
<dl class="attribute">
<dt id="apps.flashlight.FlashlightApp.ICON">
<code class="sig-name descname">ICON</code><em class="property"> = 'Default torch or flashlight icon'</em><a class="headerlink" href="#apps.flashlight.FlashlightApp.ICON" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="apps.flashlight.FlashlightApp.NAME">
<code class="sig-name descname">NAME</code><em class="property"> = 'Torch'</em><a class="headerlink" href="#apps.flashlight.FlashlightApp.NAME" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="apps.flashlight.FlashlightApp.background">
<code class="sig-name descname">background</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#apps.flashlight.FlashlightApp.background" title="Permalink to this definition">¶</a></dt>
<dd><p>De-activate the application (without losing state).</p>
</dd></dl>

<dl class="method">
<dt id="apps.flashlight.FlashlightApp.draw">
<code class="sig-name descname">draw</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#apps.flashlight.FlashlightApp.draw" title="Permalink to this definition">¶</a></dt>
<dd><p>Redraw the display from scratch.</p>
</dd></dl>

<dl class="method">
<dt id="apps.flashlight.FlashlightApp.foreground">
<code class="sig-name descname">foreground</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#apps.flashlight.FlashlightApp.foreground" title="Permalink to this definition">¶</a></dt>
<dd><p>Activate the application.</p>
</dd></dl>

<dl class="method">
<dt id="apps.flashlight.FlashlightApp.tick">
<code class="sig-name descname">tick</code><span class="sig-paren">(</span><em class="sig-param">ticks</em><span class="sig-paren">)</span><a class="headerlink" href="#apps.flashlight.FlashlightApp.tick" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<span class="target" id="module-apps.launcher"></span><dl class="class">
<dt id="apps.launcher.LauncherApp">
<em class="property">class </em><code class="sig-prename descclassname">apps.launcher.</code><code class="sig-name descname">LauncherApp</code><a class="headerlink" href="#apps.launcher.LauncherApp" title="Permalink to this definition">¶</a></dt>
<dd><p>An application launcher application.</p>
<dl class="attribute">
<dt id="apps.launcher.LauncherApp.ICON">
<code class="sig-name descname">ICON</code><em class="property"> = 'Default application icon'</em><a class="headerlink" href="#apps.launcher.LauncherApp.ICON" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="apps.launcher.LauncherApp.NAME">
<code class="sig-name descname">NAME</code><em class="property"> = 'Launcher'</em><a class="headerlink" href="#apps.launcher.LauncherApp.NAME" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="apps.launcher.LauncherApp.foreground">
<code class="sig-name descname">foreground</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#apps.launcher.LauncherApp.foreground" title="Permalink to this definition">¶</a></dt>
<dd><p>Activate the application.</p>
</dd></dl>

<dl class="method">
<dt id="apps.launcher.LauncherApp.swipe">
<code class="sig-name descname">swipe</code><span class="sig-paren">(</span><em class="sig-param">event</em><span class="sig-paren">)</span><a class="headerlink" href="#apps.launcher.LauncherApp.swipe" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="apps.launcher.LauncherApp.touch">
<code class="sig-name descname">touch</code><span class="sig-paren">(</span><em class="sig-param">event</em><span class="sig-paren">)</span><a class="headerlink" href="#apps.launcher.LauncherApp.touch" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<span class="target" id="module-apps.pager"></span><dl class="class">
<dt id="apps.pager.CrashApp">
<em class="property">class </em><code class="sig-prename descclassname">apps.pager.</code><code class="sig-name descname">CrashApp</code><span class="sig-paren">(</span><em class="sig-param">exc</em><span class="sig-paren">)</span><a class="headerlink" href="#apps.pager.CrashApp" title="Permalink to this definition">¶</a></dt>
<dd><p>Crash handler application.</p>
<p>This application is launched automatically whenever another
application crashes. Our main job it to indicate as loudly as
possible that the system is no longer running correctly. This
app deliberately enables inverted video mode in order to deliver
that message as strongly as possible.</p>
<dl class="method">
<dt id="apps.pager.CrashApp.background">
<code class="sig-name descname">background</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#apps.pager.CrashApp.background" title="Permalink to this definition">¶</a></dt>
<dd><p>Restore a normal display mode.</p>
<p>Conceal the display before the transition otherwise the inverted
bombs get noticed by the user.</p>
</dd></dl>

<dl class="method">
<dt id="apps.pager.CrashApp.foreground">
<code class="sig-name descname">foreground</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#apps.pager.CrashApp.foreground" title="Permalink to this definition">¶</a></dt>
<dd><p>Indicate the system has crashed by drawing a couple of bomb icons.</p>
<p>If you owned an Atari ST back in the mid-eighties then I hope you
recognise this as a tribute a long forgotten home computer!</p>
</dd></dl>

<dl class="method">
<dt id="apps.pager.CrashApp.swipe">
<code class="sig-name descname">swipe</code><span class="sig-paren">(</span><em class="sig-param">event</em><span class="sig-paren">)</span><a class="headerlink" href="#apps.pager.CrashApp.swipe" title="Permalink to this definition">¶</a></dt>
<dd><p>Show the exception message in a pager.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="apps.pager.PagerApp">
<em class="property">class </em><code class="sig-prename descclassname">apps.pager.</code><code class="sig-name descname">PagerApp</code><span class="sig-paren">(</span><em class="sig-param">msg</em><span class="sig-paren">)</span><a class="headerlink" href="#apps.pager.PagerApp" title="Permalink to this definition">¶</a></dt>
<dd><p>Show long text in a pager.</p>
<p>This is used to present text based information to the user. It is primarily
intended for notifications but is also used to provide debugging
information when applications crash.</p>
<dl class="attribute">
<dt id="apps.pager.PagerApp.ICON">
<code class="sig-name descname">ICON</code><em class="property"> = 'Default application icon'</em><a class="headerlink" href="#apps.pager.PagerApp.ICON" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="apps.pager.PagerApp.NAME">
<code class="sig-name descname">NAME</code><em class="property"> = 'Pager'</em><a class="headerlink" href="#apps.pager.PagerApp.NAME" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="apps.pager.PagerApp.background">
<code class="sig-name descname">background</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#apps.pager.PagerApp.background" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="apps.pager.PagerApp.foreground">
<code class="sig-name descname">foreground</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#apps.pager.PagerApp.foreground" title="Permalink to this definition">¶</a></dt>
<dd><p>Activate the application.</p>
</dd></dl>

<dl class="method">
<dt id="apps.pager.PagerApp.swipe">
<code class="sig-name descname">swipe</code><span class="sig-paren">(</span><em class="sig-param">event</em><span class="sig-paren">)</span><a class="headerlink" href="#apps.pager.PagerApp.swipe" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<span class="target" id="module-apps.testapp"></span><dl class="class">
<dt id="apps.testapp.TestApp">
<em class="property">class </em><code class="sig-prename descclassname">apps.testapp.</code><code class="sig-name descname">TestApp</code><a class="headerlink" href="#apps.testapp.TestApp" title="Permalink to this definition">¶</a></dt>
<dd><p>Simple test application.</p>
<dl class="attribute">
<dt id="apps.testapp.TestApp.ICON">
<code class="sig-name descname">ICON</code><em class="property"> = 'Default application icon'</em><a class="headerlink" href="#apps.testapp.TestApp.ICON" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="apps.testapp.TestApp.NAME">
<code class="sig-name descname">NAME</code><em class="property"> = 'Self Test'</em><a class="headerlink" href="#apps.testapp.TestApp.NAME" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="apps.testapp.TestApp.foreground">
<code class="sig-name descname">foreground</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#apps.testapp.TestApp.foreground" title="Permalink to this definition">¶</a></dt>
<dd><p>Activate the application.</p>
</dd></dl>

<dl class="method">
<dt id="apps.testapp.TestApp.press">
<code class="sig-name descname">press</code><span class="sig-paren">(</span><em class="sig-param">button</em>, <em class="sig-param">state</em><span class="sig-paren">)</span><a class="headerlink" href="#apps.testapp.TestApp.press" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="apps.testapp.TestApp.swipe">
<code class="sig-name descname">swipe</code><span class="sig-paren">(</span><em class="sig-param">event</em><span class="sig-paren">)</span><a class="headerlink" href="#apps.testapp.TestApp.swipe" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="apps.testapp.TestApp.touch">
<code class="sig-name descname">touch</code><span class="sig-paren">(</span><em class="sig-param">event</em><span class="sig-paren">)</span><a class="headerlink" href="#apps.testapp.TestApp.touch" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</div>
<div class="section" id="module-drivers.battery">
<span id="device-drivers"></span><h2>Device drivers<a class="headerlink" href="#module-drivers.battery" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="drivers.battery.Battery">
<em class="property">class </em><code class="sig-prename descclassname">drivers.battery.</code><code class="sig-name descname">Battery</code><span class="sig-paren">(</span><em class="sig-param">battery</em>, <em class="sig-param">charging</em>, <em class="sig-param">power=None</em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.battery.Battery" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="drivers.battery.Battery.charging">
<code class="sig-name descname">charging</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#drivers.battery.Battery.charging" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="drivers.battery.Battery.level">
<code class="sig-name descname">level</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#drivers.battery.Battery.level" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="drivers.battery.Battery.power">
<code class="sig-name descname">power</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#drivers.battery.Battery.power" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="drivers.battery.Battery.voltage_mv">
<code class="sig-name descname">voltage_mv</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#drivers.battery.Battery.voltage_mv" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<span class="target" id="module-drivers.cst816s"></span><p>Hynitron CST816S touch contoller driver for MicroPython.</p>
<p>After modifying this file we can test the changes by replacing the
frozen driver with the modified driver. The following command will
upload the code and integrate it into the watch namespace:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>./tools/wasptool      --exec wasp/drivers/cst816s.py      --eval &quot;watch.touch = CST816S(watch.i2c)&quot;`
</pre></div>
</div>
<dl class="class">
<dt id="drivers.cst816s.CST816S">
<em class="property">class </em><code class="sig-prename descclassname">drivers.cst816s.</code><code class="sig-name descname">CST816S</code><span class="sig-paren">(</span><em class="sig-param">bus</em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.cst816s.CST816S" title="Permalink to this definition">¶</a></dt>
<dd><p>Hynitron CST816S I2C touch controller driver.</p>
<dl class="method">
<dt id="drivers.cst816s.CST816S.get_event">
<code class="sig-name descname">get_event</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#drivers.cst816s.CST816S.get_event" title="Permalink to this definition">¶</a></dt>
<dd><p>Receive a touch event.</p>
<p>Check for a pending touch event and, if an event is pending,
prepare it ready to go in the event queue.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>An event record if an event is received, None otherwise.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<span class="target" id="module-drivers.nrf_rtc"></span><p>Real Time Clock based on the nRF-family low power counter</p>
<dl class="class">
<dt id="drivers.nrf_rtc.RTC">
<em class="property">class </em><code class="sig-prename descclassname">drivers.nrf_rtc.</code><code class="sig-name descname">RTC</code><span class="sig-paren">(</span><em class="sig-param">counter</em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.nrf_rtc.RTC" title="Permalink to this definition">¶</a></dt>
<dd><p>Real Time Clock based on the nRF-family low power counter.</p>
<dl class="method">
<dt id="drivers.nrf_rtc.RTC.get_localtime">
<code class="sig-name descname">get_localtime</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#drivers.nrf_rtc.RTC.get_localtime" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="drivers.nrf_rtc.RTC.get_time">
<code class="sig-name descname">get_time</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#drivers.nrf_rtc.RTC.get_time" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="drivers.nrf_rtc.RTC.get_uptime_ms">
<code class="sig-name descname">get_uptime_ms</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#drivers.nrf_rtc.RTC.get_uptime_ms" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the current uptime in milliseconds.</p>
</dd></dl>

<dl class="method">
<dt id="drivers.nrf_rtc.RTC.set_localtime">
<code class="sig-name descname">set_localtime</code><span class="sig-paren">(</span><em class="sig-param">t</em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.nrf_rtc.RTC.set_localtime" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="drivers.nrf_rtc.RTC.update">
<code class="sig-name descname">update</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#drivers.nrf_rtc.RTC.update" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="drivers.nrf_rtc.RTC.uptime">
<em class="property">property </em><code class="sig-name descname">uptime</code><a class="headerlink" href="#drivers.nrf_rtc.RTC.uptime" title="Permalink to this definition">¶</a></dt>
<dd><p>Provide the current uptime in seconds.</p>
</dd></dl>

</dd></dl>

<span class="target" id="module-drivers.signal"></span><dl class="class">
<dt id="drivers.signal.Signal">
<em class="property">class </em><code class="sig-prename descclassname">drivers.signal.</code><code class="sig-name descname">Signal</code><span class="sig-paren">(</span><em class="sig-param">pin</em>, <em class="sig-param">invert=False</em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.signal.Signal" title="Permalink to this definition">¶</a></dt>
<dd><p>Simplified Signal class</p>
<p>Note: The normal C implementation isn’t working for the NRF port</p>
<dl class="method">
<dt id="drivers.signal.Signal.off">
<code class="sig-name descname">off</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#drivers.signal.Signal.off" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="drivers.signal.Signal.on">
<code class="sig-name descname">on</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#drivers.signal.Signal.on" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="drivers.signal.Signal.value">
<code class="sig-name descname">value</code><span class="sig-paren">(</span><em class="sig-param">v=None</em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.signal.Signal.value" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<span class="target" id="module-drivers.st7789"></span><p>Sitronix ST7789 display driver for MicroPython.</p>
<p>Note: Although the ST7789 supports a variety of communication protocols
currently this driver only has support for SPI interfaces. However it is
structured such that other serial protocols can easily be added.</p>
<dl class="class">
<dt id="drivers.st7789.ST7789">
<em class="property">class </em><code class="sig-prename descclassname">drivers.st7789.</code><code class="sig-name descname">ST7789</code><span class="sig-paren">(</span><em class="sig-param">width</em>, <em class="sig-param">height</em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.st7789.ST7789" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="drivers.st7789.ST7789.contrast">
<code class="sig-name descname">contrast</code><span class="sig-paren">(</span><em class="sig-param">contrast</em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.st7789.ST7789.contrast" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="drivers.st7789.ST7789.fill">
<code class="sig-name descname">fill</code><span class="sig-paren">(</span><em class="sig-param">bg</em>, <em class="sig-param">x=0</em>, <em class="sig-param">y=0</em>, <em class="sig-param">w=None</em>, <em class="sig-param">h=None</em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.st7789.ST7789.fill" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="drivers.st7789.ST7789.init_display">
<code class="sig-name descname">init_display</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#drivers.st7789.ST7789.init_display" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="drivers.st7789.ST7789.invert">
<code class="sig-name descname">invert</code><span class="sig-paren">(</span><em class="sig-param">invert</em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.st7789.ST7789.invert" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="drivers.st7789.ST7789.mute">
<code class="sig-name descname">mute</code><span class="sig-paren">(</span><em class="sig-param">mute</em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.st7789.ST7789.mute" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="drivers.st7789.ST7789.poweroff">
<code class="sig-name descname">poweroff</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#drivers.st7789.ST7789.poweroff" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="drivers.st7789.ST7789.poweron">
<code class="sig-name descname">poweron</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#drivers.st7789.ST7789.poweron" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="drivers.st7789.ST7789.rawblit">
<code class="sig-name descname">rawblit</code><span class="sig-paren">(</span><em class="sig-param">buf</em>, <em class="sig-param">x</em>, <em class="sig-param">y</em>, <em class="sig-param">width</em>, <em class="sig-param">height</em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.st7789.ST7789.rawblit" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="drivers.st7789.ST7789.set_window">
<code class="sig-name descname">set_window</code><span class="sig-paren">(</span><em class="sig-param">x=0</em>, <em class="sig-param">y=0</em>, <em class="sig-param">width=None</em>, <em class="sig-param">height=None</em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.st7789.ST7789.set_window" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="drivers.st7789.ST7789_SPI">
<em class="property">class </em><code class="sig-prename descclassname">drivers.st7789.</code><code class="sig-name descname">ST7789_SPI</code><span class="sig-paren">(</span><em class="sig-param">width</em>, <em class="sig-param">height</em>, <em class="sig-param">spi</em>, <em class="sig-param">cs</em>, <em class="sig-param">dc</em>, <em class="sig-param">res=None</em>, <em class="sig-param">rate=8000000</em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.st7789.ST7789_SPI" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="drivers.st7789.ST7789_SPI.quick_end">
<code class="sig-name descname">quick_end</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#drivers.st7789.ST7789_SPI.quick_end" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="drivers.st7789.ST7789_SPI.quick_start">
<code class="sig-name descname">quick_start</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#drivers.st7789.ST7789_SPI.quick_start" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="drivers.st7789.ST7789_SPI.reset">
<code class="sig-name descname">reset</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#drivers.st7789.ST7789_SPI.reset" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="drivers.st7789.ST7789_SPI.write_cmd">
<code class="sig-name descname">write_cmd</code><span class="sig-paren">(</span><em class="sig-param">cmd</em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.st7789.ST7789_SPI.write_cmd" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="drivers.st7789.ST7789_SPI.write_data">
<code class="sig-name descname">write_data</code><span class="sig-paren">(</span><em class="sig-param">buf</em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.st7789.ST7789_SPI.write_data" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<span class="target" id="module-drivers.vibrator"></span><dl class="class">
<dt id="drivers.vibrator.Vibrator">
<em class="property">class </em><code class="sig-prename descclassname">drivers.vibrator.</code><code class="sig-name descname">Vibrator</code><span class="sig-paren">(</span><em class="sig-param">pin</em>, <em class="sig-param">active_low=False</em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.vibrator.Vibrator" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="drivers.vibrator.Vibrator.pulse">
<code class="sig-name descname">pulse</code><span class="sig-paren">(</span><em class="sig-param">duty=25</em>, <em class="sig-param">ms=40</em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.vibrator.Vibrator.pulse" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</div>
<div class="section" id="module-draw565">
<span id="libraries"></span><h2>Libraries<a class="headerlink" href="#module-draw565" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="draw565.Draw565">
<em class="property">class </em><code class="sig-prename descclassname">draw565.</code><code class="sig-name descname">Draw565</code><span class="sig-paren">(</span><em class="sig-param">display</em><span class="sig-paren">)</span><a class="headerlink" href="#draw565.Draw565" title="Permalink to this definition">¶</a></dt>
<dd><p>Drawing library for RGB565 displays.</p>
<p>A full framebufer is not required although the library will
‘borrow’ a line buffer from the underlying display driver.</p>
<dl class="method">
<dt id="draw565.Draw565.blit">
<code class="sig-name descname">blit</code><span class="sig-paren">(</span><em class="sig-param">image</em>, <em class="sig-param">x</em>, <em class="sig-param">y</em><span class="sig-paren">)</span><a class="headerlink" href="#draw565.Draw565.blit" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="draw565.Draw565.fill">
<code class="sig-name descname">fill</code><span class="sig-paren">(</span><em class="sig-param">bg=None</em>, <em class="sig-param">x=0</em>, <em class="sig-param">y=0</em>, <em class="sig-param">w=None</em>, <em class="sig-param">h=None</em><span class="sig-paren">)</span><a class="headerlink" href="#draw565.Draw565.fill" title="Permalink to this definition">¶</a></dt>
<dd><p>Draw a solid color rectangle.</p>
<p>If no arguments a provided the whole display will be filled with
the background color.</p>
</dd></dl>

<dl class="method">
<dt id="draw565.Draw565.reset">
<code class="sig-name descname">reset</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#draw565.Draw565.reset" title="Permalink to this definition">¶</a></dt>
<dd><p>Restore the default colour and font.</p>
</dd></dl>

<dl class="method">
<dt id="draw565.Draw565.rleblit">
<code class="sig-name descname">rleblit</code><span class="sig-paren">(</span><em class="sig-param">image</em>, <em class="sig-param">pos=(0</em>, <em class="sig-param">0)</em>, <em class="sig-param">fg=65535</em>, <em class="sig-param">bg=0</em><span class="sig-paren">)</span><a class="headerlink" href="#draw565.Draw565.rleblit" title="Permalink to this definition">¶</a></dt>
<dd><p>Decode and draw a 1-bit RLE image.</p>
</dd></dl>

<dl class="method">
<dt id="draw565.Draw565.set_color">
<code class="sig-name descname">set_color</code><span class="sig-paren">(</span><em class="sig-param">color</em>, <em class="sig-param">bg=0</em><span class="sig-paren">)</span><a class="headerlink" href="#draw565.Draw565.set_color" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the foreground (color) and background (bg) color.</p>
<p>The supplied color will be used for all monochrome drawing operations.
If no background color is provided then the background will be set
to black.</p>
</dd></dl>

<dl class="method">
<dt id="draw565.Draw565.set_font">
<code class="sig-name descname">set_font</code><span class="sig-paren">(</span><em class="sig-param">font</em><span class="sig-paren">)</span><a class="headerlink" href="#draw565.Draw565.set_font" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the font used for rendering text.</p>
</dd></dl>

<dl class="method">
<dt id="draw565.Draw565.string">
<code class="sig-name descname">string</code><span class="sig-paren">(</span><em class="sig-param">s</em>, <em class="sig-param">x</em>, <em class="sig-param">y</em>, <em class="sig-param">width=None</em><span class="sig-paren">)</span><a class="headerlink" href="#draw565.Draw565.string" title="Permalink to this definition">¶</a></dt>
<dd><p>Draw a string at the supplied position.</p>
<p>If no width is provided then the text will be left justified,
otherwise the text will be centered within the provided width and,
importantly, the remaining width will be filled with the background
color (to ensure that if we update one string with a narrower one
there is no need to “undraw” it)</p>
</dd></dl>

<dl class="method">
<dt id="draw565.Draw565.wrap">
<code class="sig-name descname">wrap</code><span class="sig-paren">(</span><em class="sig-param">s</em>, <em class="sig-param">width</em><span class="sig-paren">)</span><a class="headerlink" href="#draw565.Draw565.wrap" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<span class="target" id="module-icons"></span><span class="target" id="module-fonts.clock"></span><span class="target" id="module-fonts.sans24"></span><span class="target" id="module-logo"></span><span class="target" id="module-widgets"></span><dl class="class">
<dt id="widgets.BatteryMeter">
<em class="property">class </em><code class="sig-prename descclassname">widgets.</code><code class="sig-name descname">BatteryMeter</code><a class="headerlink" href="#widgets.BatteryMeter" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="widgets.BatteryMeter.draw">
<code class="sig-name descname">draw</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#widgets.BatteryMeter.draw" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="widgets.BatteryMeter.update">
<code class="sig-name descname">update</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#widgets.BatteryMeter.update" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="widgets.ScrollIndicator">
<em class="property">class </em><code class="sig-prename descclassname">widgets.</code><code class="sig-name descname">ScrollIndicator</code><span class="sig-paren">(</span><em class="sig-param">x=222</em>, <em class="sig-param">y=216</em><span class="sig-paren">)</span><a class="headerlink" href="#widgets.ScrollIndicator" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="widgets.ScrollIndicator.draw">
<code class="sig-name descname">draw</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#widgets.ScrollIndicator.draw" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="widgets.ScrollIndicator.update">
<code class="sig-name descname">update</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#widgets.ScrollIndicator.update" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</div>
<div class="section" id="bootloader">
<h2>Bootloader<a class="headerlink" href="#bootloader" title="Permalink to this headline">¶</a></h2>
<p>The bootloader implements a couple of protocols that allow the bootloader
and payload to communicate during a reset or on handover from bootloader
to application.</p>
<div class="section" id="gpregret-protocol">
<h3>GPREGRET protocol<a class="headerlink" href="#gpregret-protocol" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">GPREGRET</span></code> is a general purpose 8-bit retention register that is preserved
in all power states of the nRF52 (including System OFF mode when SRAM
content is destroyed).</p>
<p>It can be used by the application to request specific bootloader behaviours
during a reset:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 22%" />
<col style="width: 7%" />
<col style="width: 71%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Name</p></td>
<td><p>Value</p></td>
<td><p>Description</p></td>
</tr>
<tr class="row-even"><td><p>OTA_APPJUM</p></td>
<td><p>0xb1</p></td>
<td><p>Bootloader entered (without reset) from application.</p></td>
</tr>
<tr class="row-odd"><td><p>OTA_RESET</p></td>
<td><p>0xa8</p></td>
<td><p>Enter OTA (Bluetooth) recovery mode</p></td>
</tr>
<tr class="row-even"><td><p>SERIAL_ONLY_RESET</p></td>
<td><p>0x4e</p></td>
<td><p>Enter UART recovery mode (if applicable)</p></td>
</tr>
<tr class="row-odd"><td><p>UF2_RESET</p></td>
<td><p>0x57</p></td>
<td><p>Enter USB recovery mode (if applicable)</p></td>
</tr>
<tr class="row-even"><td><p>FORCE_APP_BOOT</p></td>
<td><p>0x65</p></td>
<td><p>Force direct application boot (no splash screen)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="pnvram-protocol">
<h3>PNVRAM protocol<a class="headerlink" href="#pnvram-protocol" title="Permalink to this headline">¶</a></h3>
<p>The pseudo non-volatile RAM is a small block of regular static RAM that,
once initialized, can be used to share information.</p>
<p>The PNVRAM starts at 0x200039c0 and is 32 bytes long.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 13%" />
<col style="width: 87%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Address</p></td>
<td><p>Description</p></td>
</tr>
<tr class="row-even"><td><p>0x200039c0</p></td>
<td><p>Guard value. Must be set to 0x1abe11ed .</p></td>
</tr>
<tr class="row-odd"><td><p>0x200039c4</p></td>
<td><p>Course grained RTC value (bootloader must preserve but can ignore).</p></td>
</tr>
<tr class="row-even"><td><p>0x200039c8</p></td>
<td><p>RTC millisecond counter (bootloader must increment this).</p></td>
</tr>
<tr class="row-odd"><td><p>0x200039cc</p></td>
<td><p>Reserved</p></td>
</tr>
<tr class="row-even"><td><p>0x200039d0</p></td>
<td><p>Reserved</p></td>
</tr>
<tr class="row-odd"><td><p>0x200039d4</p></td>
<td><p>Reserved</p></td>
</tr>
<tr class="row-even"><td><p>0x200039d8</p></td>
<td><p>Reserved</p></td>
</tr>
<tr class="row-odd"><td><p>0x200039cc</p></td>
<td><p>Guard value. Must be set to 0x10adab1e .</p></td>
</tr>
</tbody>
</table>
<p>Note: <em>The PNVRAM protocol allows up to 28 bytes to be transfered (compared to
2 bytes via GPREGRET and GPREGRET2) but it is less versatile. For example
FORCE_APP_BOOT cannot be implmented using PNVRAM.</em></p>
<p>The RTC millisecond counter is incremented whenever the bootloader is
active (during splash screen or early UART recovery mode, during an
update). It can be consumed by the application to prevent the current
time being lost during an update.</p>
</div>
</div>
<div class="section" id="watchdog">
<h2>Watchdog<a class="headerlink" href="#watchdog" title="Permalink to this headline">¶</a></h2>
<p>Form-factor devices such as smart watches and fitness trackers do not usually
have any hardware mechanism to allow the user to force a failed device into
bootloader mode. This makes them difficult to develop on because opening the
case to access a SWD or reset pins may compromise their waterproofing.</p>
<p>WASP uses a watchdog timer (WDT) combined with a single hardware button in
order to provide a robust mechanism to allow the user to force entry into a
over-the-air firmware recovery mode that allows the buggy application to be
replaced.</p>
<p>The software responsibilities to implement this are split between the
bootloader and the application, although the application responsibilities
are intentionally minimal.</p>
<div class="section" id="id2">
<h3>Bootloader<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>The bootloader implements an over-the-air recovery mode, as well as handling
normal boot, where it’s role is to display the splash screen.</p>
<p>Additionally the bootloader implements several watchdog related features
necessary for robust reboot handling:</p>
<ol class="arabic simple">
<li><p>The bootloader configures the watchdog prior to booting the main
application. This is a simple, single channel reload request, watchdog
with a 5 second timeout.</p></li>
<li><p>The bootloader checks the reset reason prior too booting the main
application. If it detects a watchdog reset the bootloader switches
automatically to DFU mode.</p></li>
<li><p>The bootlaoder initialized the pinmux allowing the hardware button
state to be observed.</p></li>
<li><p>The bootloader monitors the hardware button and switches back to the main
application when it is pressed.</p></li>
</ol>
<p>From this list #1 and #2 are needed to ensure robust WDT handling whilst #3
and # 4 ensure the user can switch back to application from the device
itself if they ever accidentally trigger entry to recovery mode.</p>
</div>
<div class="section" id="application">
<h3>Application<a class="headerlink" href="#application" title="Permalink to this headline">¶</a></h3>
<p>The application’s role is to carefully pet the watchdog so that it will
trigger automatically if the hardware button is held down for five
seconds.</p>
<p>Key points for robustness:</p>
<ol class="arabic simple">
<li><p>Unlike a normal watchdog we can be fairly reckless about where in the
code we pet the dog. For example petting the dog from a timer interrupt
is fine because we only need the dog to bark if the hardware button is
pressed.</p></li>
<li><p>The routine to pet the dog is predicated on the hardware button not
being pressed.</p></li>
<li><p>The routine to pet the dog is also predicated on the hardware button
still being correctly configured.</p></li>
</ol>
<p>To avoid mistakes the application should contain no subroutines that
unconditionally pet the dog; they should all implement #2 and #3 from
the above list.</p>
<p>Note: <em>nRF52 microcontrollers implement a distributed pin-muxing
mechanism meaning most peripheral can acidentally “steal” a pin
if the pin is requested by the peripheral. This requires a fully
robust implementation of #3 to visit the PSEL registers of every
peripheral that can control pins. The code currently used in
wasp-os does not yet meet this criteria.</em></p>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">WASP-OS</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="README.html">Watch Application System in Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="appguide.html">Application Writer’s Guide</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">WASP Reference Manual</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#module-wasp">System management</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-apps.clock">Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-drivers.battery">Device drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-draw565">Libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="#bootloader">Bootloader</a></li>
<li class="toctree-l2"><a class="reference internal" href="#watchdog">Watchdog</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="TODO.html">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">Licensing</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="appguide.html" title="previous chapter">Application Writer’s Guide</a></li>
      <li>Next: <a href="TODO.html" title="next chapter">Roadmap</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Daniel Thompson.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.2.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/wasp.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>