
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>WASP Reference Manual &#8212; WASP-OS  documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Roadmap" href="TODO.html" />
    <link rel="prev" title="Application Writer’s Guide" href="appguide.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="wasp-reference-manual">
<span id="id1"></span><h1>WASP Reference Manual<a class="headerlink" href="#wasp-reference-manual" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#module-wasp" id="id2">System</a></p>
<ul>
<li><p><a class="reference internal" href="#wasp-os-system-manager" id="id3">Wasp-os system manager</a></p></li>
<li><p><a class="reference internal" href="#rgb565-drawing-library" id="id4">RGB565 drawing library</a></p></li>
<li><p><a class="reference internal" href="#widget-library" id="id5">Widget library</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#module-drivers.battery" id="id6">Device drivers</a></p>
<ul>
<li><p><a class="reference internal" href="#generic-lithium-ion-battery-driver" id="id7">Generic lithium ion battery driver</a></p></li>
<li><p><a class="reference internal" href="#hynitron-cst816s-touch-contoller-driver" id="id8">Hynitron CST816S touch contoller driver</a></p></li>
<li><p><a class="reference internal" href="#nrf-family-rtc-driver" id="id9">nRF-family RTC driver</a></p></li>
<li><p><a class="reference internal" href="#inverting-pin-wrapper" id="id10">Inverting pin wrapper</a></p></li>
<li><p><a class="reference internal" href="#sitronix-st7789-display-driver" id="id11">Sitronix ST7789 display driver</a></p></li>
<li><p><a class="reference internal" href="#generic-pwm-capable-vibration-motor-driver" id="id12">Generic PWM capable vibration motor driver</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#module-apps.clock" id="id13">Applications</a></p>
<ul>
<li><p><a class="reference internal" href="#digital-clock" id="id14">Digital clock</a></p></li>
<li><p><a class="reference internal" href="#flashlight" id="id15">Flashlight</a></p></li>
<li><p><a class="reference internal" href="#application-launcher" id="id16">Application launcher</a></p></li>
<li><p><a class="reference internal" href="#pager-applications" id="id17">Pager applications</a></p></li>
<li><p><a class="reference internal" href="#self-tests" id="id18">Self Tests</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#bootloader" id="id19">Bootloader</a></p>
<ul>
<li><p><a class="reference internal" href="#gpregret-protocol" id="id20">GPREGRET protocol</a></p></li>
<li><p><a class="reference internal" href="#pnvram-protocol" id="id21">PNVRAM protocol</a></p></li>
<li><p><a class="reference internal" href="#watchdog-protocol" id="id22">Watchdog protocol</a></p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="module-wasp">
<span id="system"></span><h2><a class="toc-backref" href="#id2">System</a><a class="headerlink" href="#module-wasp" title="Permalink to this headline">¶</a></h2>
<div class="section" id="wasp-os-system-manager">
<h3><a class="toc-backref" href="#id3">Wasp-os system manager</a><a class="headerlink" href="#wasp-os-system-manager" title="Permalink to this headline">¶</a></h3>
<dl class="data">
<dt id="wasp.wasp.system">
<code class="sig-prename descclassname">wasp.</code><code class="sig-name descname">system</code><a class="headerlink" href="#wasp.wasp.system" title="Permalink to this definition">¶</a></dt>
<dd><p>wasp.system is the system-wide singleton instance of <a class="reference internal" href="#wasp.Manager" title="wasp.Manager"><code class="xref py py-class docutils literal notranslate"><span class="pre">Manager</span></code></a>.
Application must use this instance to access the system services provided
by the manager.</p>
</dd></dl>

<dl class="data">
<dt id="wasp.wasp.watch">
<code class="sig-prename descclassname">wasp.</code><code class="sig-name descname">watch</code><a class="headerlink" href="#wasp.wasp.watch" title="Permalink to this definition">¶</a></dt>
<dd><p>wasp.watch is an import of <code class="xref py py-mod docutils literal notranslate"><span class="pre">watch</span></code> and is simply provided as a
shortcut (and to reduce memory by keeping it out of other namespaces).</p>
</dd></dl>

<dl class="class">
<dt id="wasp.EventMask">
<em class="property">class </em><code class="sig-prename descclassname">wasp.</code><code class="sig-name descname">EventMask</code><a class="headerlink" href="#wasp.EventMask" title="Permalink to this definition">¶</a></dt>
<dd><p>Enumerated event masks.</p>
</dd></dl>

<dl class="class">
<dt id="wasp.EventType">
<em class="property">class </em><code class="sig-prename descclassname">wasp.</code><code class="sig-name descname">EventType</code><a class="headerlink" href="#wasp.EventType" title="Permalink to this definition">¶</a></dt>
<dd><p>Enumerated interface actions.</p>
<p>MicroPython does not implement the enum module so EventType
is simply a regular object which acts as a namespace.</p>
</dd></dl>

<dl class="class">
<dt id="wasp.Manager">
<em class="property">class </em><code class="sig-prename descclassname">wasp.</code><code class="sig-name descname">Manager</code><a class="headerlink" href="#wasp.Manager" title="Permalink to this definition">¶</a></dt>
<dd><p>WASP system manager</p>
<p>The manager is responsible for handling top-level UI events and
dispatching them to the foreground application. It also provides
services to the application.</p>
<p>The manager is expected to have a single system-wide instance
which can be accessed via <a class="reference internal" href="#wasp.wasp.system" title="wasp.wasp.system"><code class="xref py py-data docutils literal notranslate"><span class="pre">wasp.system</span></code></a> .</p>
<dl class="method">
<dt id="wasp.Manager.brightness">
<em class="property">property </em><code class="sig-name descname">brightness</code><a class="headerlink" href="#wasp.Manager.brightness" title="Permalink to this definition">¶</a></dt>
<dd><p>Cached copy of the brightness current written to the hardware.</p>
</dd></dl>

<dl class="method">
<dt id="wasp.Manager.keep_awake">
<code class="sig-name descname">keep_awake</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wasp.Manager.keep_awake" title="Permalink to this definition">¶</a></dt>
<dd><p>Reset the keep awake timer.</p>
</dd></dl>

<dl class="method">
<dt id="wasp.Manager.navigate">
<code class="sig-name descname">navigate</code><span class="sig-paren">(</span><em class="sig-param">direction=None</em><span class="sig-paren">)</span><a class="headerlink" href="#wasp.Manager.navigate" title="Permalink to this definition">¶</a></dt>
<dd><p>Navigate to a new application.</p>
<p>Left/right navigation is used to switch between applications in the
quick application ring. Applications on the ring are not permitted
to subscribe to :py:data`EventMask.SWIPE_LEFTRIGHT` events.</p>
<p>Swipe up is used to bring up the launcher. Clock applications are not
permitted to subscribe to :py:data`EventMask.SWIPE_UPDOWN` events since
they should expect to be the default application (and is important that
we can trigger the launcher from the default application).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>direction</strong> (<em>int</em>) – The direction of the navigation</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="wasp.Manager.register">
<code class="sig-name descname">register</code><span class="sig-paren">(</span><em class="sig-param">app</em>, <em class="sig-param">quick_ring=False</em><span class="sig-paren">)</span><a class="headerlink" href="#wasp.Manager.register" title="Permalink to this definition">¶</a></dt>
<dd><p>Register an application with the system.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>app</strong> (<em>object</em>) – The application to regsister</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="wasp.Manager.request_event">
<code class="sig-name descname">request_event</code><span class="sig-paren">(</span><em class="sig-param">event_mask</em><span class="sig-paren">)</span><a class="headerlink" href="#wasp.Manager.request_event" title="Permalink to this definition">¶</a></dt>
<dd><p>Subscribe to events.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>event_mask</strong> (<em>int</em>) – The set of events to subscribe to.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="wasp.Manager.request_tick">
<code class="sig-name descname">request_tick</code><span class="sig-paren">(</span><em class="sig-param">period_ms=None</em><span class="sig-paren">)</span><a class="headerlink" href="#wasp.Manager.request_tick" title="Permalink to this definition">¶</a></dt>
<dd><p>Request (and subscribe to) a periodic tick event.</p>
<p>Note: With the current simplistic timer implementation sub-second
tick intervals are not possible.</p>
</dd></dl>

<dl class="method">
<dt id="wasp.Manager.run">
<code class="sig-name descname">run</code><span class="sig-paren">(</span><em class="sig-param">no_except=True</em><span class="sig-paren">)</span><a class="headerlink" href="#wasp.Manager.run" title="Permalink to this definition">¶</a></dt>
<dd><p>Run the system manager synchronously.</p>
<p>This allows all watch management activities to handle in the
normal execution context meaning any exceptions and other problems
can be observed interactively via the console.</p>
</dd></dl>

<dl class="method">
<dt id="wasp.Manager.sleep">
<code class="sig-name descname">sleep</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wasp.Manager.sleep" title="Permalink to this definition">¶</a></dt>
<dd><p>Enter the deepest sleep state possible.</p>
</dd></dl>

<dl class="method">
<dt id="wasp.Manager.switch">
<code class="sig-name descname">switch</code><span class="sig-paren">(</span><em class="sig-param">app</em><span class="sig-paren">)</span><a class="headerlink" href="#wasp.Manager.switch" title="Permalink to this definition">¶</a></dt>
<dd><p>Switch to the requested application.</p>
</dd></dl>

<dl class="method">
<dt id="wasp.Manager.wake">
<code class="sig-name descname">wake</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wasp.Manager.wake" title="Permalink to this definition">¶</a></dt>
<dd><p>Return to a running state.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="wasp.PinHandler">
<em class="property">class </em><code class="sig-prename descclassname">wasp.</code><code class="sig-name descname">PinHandler</code><span class="sig-paren">(</span><em class="sig-param">pin</em><span class="sig-paren">)</span><a class="headerlink" href="#wasp.PinHandler" title="Permalink to this definition">¶</a></dt>
<dd><p>Pin (and Signal) event generator.</p>
<p>TODO: Currently this driver doesn’t actually implement any
debounce but it will!</p>
<dl class="method">
<dt id="wasp.PinHandler.get_event">
<code class="sig-name descname">get_event</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wasp.PinHandler.get_event" title="Permalink to this definition">¶</a></dt>
<dd><p>Receive a pin change event.</p>
<p>Check for a pending pin change event and, if an event is pending,
return it.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>boolean of the pin state if an event is received, None
otherwise.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<span class="target" id="module-draw565"></span><div class="section" id="rgb565-drawing-library">
<h3><a class="toc-backref" href="#id4">RGB565 drawing library</a><a class="headerlink" href="#rgb565-drawing-library" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="draw565.Draw565">
<em class="property">class </em><code class="sig-prename descclassname">draw565.</code><code class="sig-name descname">Draw565</code><span class="sig-paren">(</span><em class="sig-param">display</em><span class="sig-paren">)</span><a class="headerlink" href="#draw565.Draw565" title="Permalink to this definition">¶</a></dt>
<dd><p>Drawing library for RGB565 displays.</p>
<p>A full framebufer is not required although the library will
‘borrow’ a line buffer from the underlying display driver.</p>
<dl class="method">
<dt id="draw565.Draw565.__init__">
<code class="sig-name descname">__init__</code><span class="sig-paren">(</span><em class="sig-param">display</em><span class="sig-paren">)</span><a class="headerlink" href="#draw565.Draw565.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>Initialise the library.</p>
<p>Defaults to white-on-black for monochrome drawing operations
and 24pt Sans Serif text.</p>
</dd></dl>

<dl class="method">
<dt id="draw565.Draw565.blit">
<code class="sig-name descname">blit</code><span class="sig-paren">(</span><em class="sig-param">image</em>, <em class="sig-param">x</em>, <em class="sig-param">y</em><span class="sig-paren">)</span><a class="headerlink" href="#draw565.Draw565.blit" title="Permalink to this definition">¶</a></dt>
<dd><p>Decode and draw an encoded image.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image</strong> – Image data in either 1-bit RLE or 2-bit RLE formats. The
format will be autodetected</p></li>
<li><p><strong>x</strong> – X coordinate for the left-most pixels in the image</p></li>
<li><p><strong>y</strong> – Y coordinate for the top-most pixels in the image</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="draw565.Draw565.fill">
<code class="sig-name descname">fill</code><span class="sig-paren">(</span><em class="sig-param">bg=None</em>, <em class="sig-param">x=0</em>, <em class="sig-param">y=0</em>, <em class="sig-param">w=None</em>, <em class="sig-param">h=None</em><span class="sig-paren">)</span><a class="headerlink" href="#draw565.Draw565.fill" title="Permalink to this definition">¶</a></dt>
<dd><p>Draw a solid colour rectangle.</p>
<p>If no arguments a provided the whole display will be filled with
the background colour (typically black).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>bg</strong> – Background colour (in RGB565 format)</p></li>
<li><p><strong>x</strong> – X coordinate of the left-most pixels of the rectangle</p></li>
<li><p><strong>y</strong> – Y coordinate of the top-most pixels of the rectangle</p></li>
<li><p><strong>w</strong> – Width of the rectangle, defaults to None (which means select
the right-most pixel of the display)</p></li>
<li><p><strong>h</strong> – Height of the rectangle, defaults to None (which means select
the bottom-most pixel of the display)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="draw565.Draw565.reset">
<code class="sig-name descname">reset</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#draw565.Draw565.reset" title="Permalink to this definition">¶</a></dt>
<dd><p>Restore the default colours and font.</p>
<p>Default colours are white-on-block (white foreground, black
background) and the default font is 24pt Sans Serif.</p>
</dd></dl>

<dl class="method">
<dt id="draw565.Draw565.rleblit">
<code class="sig-name descname">rleblit</code><span class="sig-paren">(</span><em class="sig-param">image</em>, <em class="sig-param">pos=(0</em>, <em class="sig-param">0)</em>, <em class="sig-param">fg=65535</em>, <em class="sig-param">bg=0</em><span class="sig-paren">)</span><a class="headerlink" href="#draw565.Draw565.rleblit" title="Permalink to this definition">¶</a></dt>
<dd><p>Decode and draw a 1-bit RLE image.</p>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version M2: </span>Use <a class="reference internal" href="#draw565.Draw565.blit" title="draw565.Draw565.blit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">blit()</span></code></a> instead.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="draw565.Draw565.set_color">
<code class="sig-name descname">set_color</code><span class="sig-paren">(</span><em class="sig-param">color</em>, <em class="sig-param">bg=0</em><span class="sig-paren">)</span><a class="headerlink" href="#draw565.Draw565.set_color" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the foreground and background colours.</p>
<p>The supplied colour will be used for all monochrome drawing operations.
If no background colour is provided then the background will be set
to black.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>color</strong> – Foreground colour</p></li>
<li><p><strong>bg</strong> – Background colour, defaults to black</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="draw565.Draw565.set_font">
<code class="sig-name descname">set_font</code><span class="sig-paren">(</span><em class="sig-param">font</em><span class="sig-paren">)</span><a class="headerlink" href="#draw565.Draw565.set_font" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the font used for rendering text.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>font</strong> – A font module generated using <code class="docutils literal notranslate"><span class="pre">font_to_py.py</span></code>.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="draw565.Draw565.string">
<code class="sig-name descname">string</code><span class="sig-paren">(</span><em class="sig-param">s</em>, <em class="sig-param">x</em>, <em class="sig-param">y</em>, <em class="sig-param">width=None</em><span class="sig-paren">)</span><a class="headerlink" href="#draw565.Draw565.string" title="Permalink to this definition">¶</a></dt>
<dd><p>Draw a string at the supplied position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>s</strong> – String to render</p></li>
<li><p><strong>x</strong> – X coordinate for the left-most pixels in the image</p></li>
<li><p><strong>y</strong> – Y coordinate for the top-most pixels in the image</p></li>
<li><p><strong>width</strong> – If no width is provided then the text will be left
justified, otherwise the text will be centred within the
provided width and, importantly, the remaining width will
be filled with the background colour (to ensure that if
we update one string with a narrower one there is no
need to “undraw” it)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="draw565.Draw565.wrap">
<code class="sig-name descname">wrap</code><span class="sig-paren">(</span><em class="sig-param">s</em>, <em class="sig-param">width</em><span class="sig-paren">)</span><a class="headerlink" href="#draw565.Draw565.wrap" title="Permalink to this definition">¶</a></dt>
<dd><p>Chunk a string so it can rendered within a specified width.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">draw</span> <span class="o">=</span> <span class="n">wasp</span><span class="o">.</span><span class="n">watch</span><span class="o">.</span><span class="n">drawable</span>
<span class="n">chunks</span> <span class="o">=</span> <span class="n">draw</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">long_string</span><span class="p">,</span> <span class="mi">240</span><span class="p">)</span>

<span class="c1"># line(1) will provide the first line</span>
<span class="c1"># line(len(chunks)-1) will provide the last line</span>
<span class="k">def</span> <span class="nf">line</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">long_string</span><span class="p">[</span><span class="n">chunks</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span><span class="n">chunks</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>s</strong> – String to be chunked</p></li>
<li><p><strong>width</strong> – Width to wrap the text into</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>List of chunk boundaries</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<span class="target" id="module-icons"></span><span class="target" id="module-fonts.clock"></span><span class="target" id="module-fonts.sans24"></span><span class="target" id="module-logo"></span><span class="target" id="module-widgets"></span><div class="section" id="widget-library">
<h3><a class="toc-backref" href="#id5">Widget library</a><a class="headerlink" href="#widget-library" title="Permalink to this headline">¶</a></h3>
<p>The widget library allows common fragments of logic and drawing code to be
shared between applications.</p>
<dl class="class">
<dt id="widgets.BatteryMeter">
<em class="property">class </em><code class="sig-prename descclassname">widgets.</code><code class="sig-name descname">BatteryMeter</code><a class="headerlink" href="#widgets.BatteryMeter" title="Permalink to this definition">¶</a></dt>
<dd><p>Battery meter widget.</p>
<p>A simple battery meter with a charging indicator, will draw at the
top-right of the display.</p>
<dl class="method">
<dt id="widgets.BatteryMeter.draw">
<code class="sig-name descname">draw</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#widgets.BatteryMeter.draw" title="Permalink to this definition">¶</a></dt>
<dd><p>Draw from meter (from scratch).</p>
</dd></dl>

<dl class="method">
<dt id="widgets.BatteryMeter.update">
<code class="sig-name descname">update</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#widgets.BatteryMeter.update" title="Permalink to this definition">¶</a></dt>
<dd><p>Update the meter.</p>
<p>The update is lazy and won’t redraw unless the level has changed.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="widgets.ScrollIndicator">
<em class="property">class </em><code class="sig-prename descclassname">widgets.</code><code class="sig-name descname">ScrollIndicator</code><span class="sig-paren">(</span><em class="sig-param">x=222</em>, <em class="sig-param">y=216</em><span class="sig-paren">)</span><a class="headerlink" href="#widgets.ScrollIndicator" title="Permalink to this definition">¶</a></dt>
<dd><p>Scrolling indicator.</p>
<p>A simple battery meter with a charging indicator, will draw at the
top-right of the display.</p>
<dl class="method">
<dt id="widgets.ScrollIndicator.draw">
<code class="sig-name descname">draw</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#widgets.ScrollIndicator.draw" title="Permalink to this definition">¶</a></dt>
<dd><p>Draw from scrolling indicator.</p>
<p>For this simple widget <a class="reference internal" href="#widgets.ScrollIndicator.draw" title="widgets.ScrollIndicator.draw"><code class="xref py py-meth docutils literal notranslate"><span class="pre">draw()</span></code></a> is simply a synonym for
<a class="reference internal" href="#widgets.ScrollIndicator.update" title="widgets.ScrollIndicator.update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">update()</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt id="widgets.ScrollIndicator.update">
<code class="sig-name descname">update</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#widgets.ScrollIndicator.update" title="Permalink to this definition">¶</a></dt>
<dd><p>Update from scrolling indicator.</p>
</dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="module-drivers.battery">
<span id="device-drivers"></span><h2><a class="toc-backref" href="#id6">Device drivers</a><a class="headerlink" href="#module-drivers.battery" title="Permalink to this headline">¶</a></h2>
<div class="section" id="generic-lithium-ion-battery-driver">
<h3><a class="toc-backref" href="#id7">Generic lithium ion battery driver</a><a class="headerlink" href="#generic-lithium-ion-battery-driver" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="drivers.battery.Battery">
<em class="property">class </em><code class="sig-prename descclassname">drivers.battery.</code><code class="sig-name descname">Battery</code><span class="sig-paren">(</span><em class="sig-param">battery</em>, <em class="sig-param">charging</em>, <em class="sig-param">power=None</em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.battery.Battery" title="Permalink to this definition">¶</a></dt>
<dd><p>Generic lithium ion battery driver.</p>
<dl class="method">
<dt id="drivers.battery.Battery.__init__">
<code class="sig-name descname">__init__</code><span class="sig-paren">(</span><em class="sig-param">battery</em>, <em class="sig-param">charging</em>, <em class="sig-param">power=None</em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.battery.Battery.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>Specify the pins used to provide battery status.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>battery</strong> (<em>Pin</em>) – The ADC-capable pin that can be used to measure
battery voltage.</p></li>
<li><p><strong>charging</strong> (<em>Pin</em>) – A pin (or Signal) that reports the charger status.</p></li>
<li><p><strong>power</strong> (<em>Pin</em>) – A pin (or Signal) that reports whether the device
has external power, defaults to None (which means
use the charging pin for power reporting too).</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="drivers.battery.Battery.charging">
<code class="sig-name descname">charging</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#drivers.battery.Battery.charging" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the charging state of the battery.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>True if the battery is charging, False otherwise.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="drivers.battery.Battery.level">
<code class="sig-name descname">level</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#drivers.battery.Battery.level" title="Permalink to this definition">¶</a></dt>
<dd><p>Estimate the battery level.</p>
<p>The current the estimation approach is extremely simple. It is assumes
the discharge from 4v to 3.5v is roughly linear and 4v is 100% and
that 3.5v is 5%. Below 3.5v the voltage will start to drop pretty
sharply to we will drop from 5% to 0% pretty fast… but we’ll
live with that for now.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>Estimate battery level in percent.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="drivers.battery.Battery.power">
<code class="sig-name descname">power</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#drivers.battery.Battery.power" title="Permalink to this definition">¶</a></dt>
<dd><p>Check whether the device has external power.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>True if the device has an external power source, False
otherwise.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="drivers.battery.Battery.voltage_mv">
<code class="sig-name descname">voltage_mv</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#drivers.battery.Battery.voltage_mv" title="Permalink to this definition">¶</a></dt>
<dd><p>Read the battery voltage.</p>
<p>Assumes a 50/50 voltage divider and a 3.3v power supply</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>Battery voltage, in millivolts.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<span class="target" id="module-drivers.cst816s"></span><div class="section" id="hynitron-cst816s-touch-contoller-driver">
<h3><a class="toc-backref" href="#id8">Hynitron CST816S touch contoller driver</a><a class="headerlink" href="#hynitron-cst816s-touch-contoller-driver" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="drivers.cst816s.CST816S">
<em class="property">class </em><code class="sig-prename descclassname">drivers.cst816s.</code><code class="sig-name descname">CST816S</code><span class="sig-paren">(</span><em class="sig-param">bus</em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.cst816s.CST816S" title="Permalink to this definition">¶</a></dt>
<dd><p>Hynitron CST816S I2C touch controller driver.</p>
<dl class="method">
<dt id="drivers.cst816s.CST816S.__init__">
<code class="sig-name descname">__init__</code><span class="sig-paren">(</span><em class="sig-param">bus</em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.cst816s.CST816S.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>Specify the bus used by the touch controller.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>bus</strong> (<em>machine.I2C</em>) – I2C bus for the CST816S.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="drivers.cst816s.CST816S.get_event">
<code class="sig-name descname">get_event</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#drivers.cst816s.CST816S.get_event" title="Permalink to this definition">¶</a></dt>
<dd><p>Receive a touch event.</p>
<p>Check for a pending touch event and, if an event is pending,
prepare it ready to go in the event queue.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>An event record if an event is received, None otherwise.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<span class="target" id="module-drivers.nrf_rtc"></span><div class="section" id="nrf-family-rtc-driver">
<h3><a class="toc-backref" href="#id9">nRF-family RTC driver</a><a class="headerlink" href="#nrf-family-rtc-driver" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="drivers.nrf_rtc.RTC">
<em class="property">class </em><code class="sig-prename descclassname">drivers.nrf_rtc.</code><code class="sig-name descname">RTC</code><span class="sig-paren">(</span><em class="sig-param">counter</em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.nrf_rtc.RTC" title="Permalink to this definition">¶</a></dt>
<dd><p>Real Time Clock based on the nRF-family low power counter.</p>
<dl class="method">
<dt id="drivers.nrf_rtc.RTC.__init__">
<code class="sig-name descname">__init__</code><span class="sig-paren">(</span><em class="sig-param">counter</em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.nrf_rtc.RTC.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>Wrap an RTCounter to provide a fully fledged Real Time Clock.</p>
<p>If the PNVRAM is valid then we use it to initialize the RTC otherwise
we just make something up.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>counter</strong> (<em>RTCounter</em>) – The RTCCounter channel to adopt.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="drivers.nrf_rtc.RTC.get_localtime">
<code class="sig-name descname">get_localtime</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#drivers.nrf_rtc.RTC.get_localtime" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the current time and date.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>Wall time formatted as (yyyy, mm, dd, HH, MM, SS, wday, yday)</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="drivers.nrf_rtc.RTC.get_time">
<code class="sig-name descname">get_time</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#drivers.nrf_rtc.RTC.get_time" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the current time.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>Wall time formatted as (HH, MM, SS)</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="drivers.nrf_rtc.RTC.get_uptime_ms">
<code class="sig-name descname">get_uptime_ms</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#drivers.nrf_rtc.RTC.get_uptime_ms" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the current uptime in milliseconds.</p>
</dd></dl>

<dl class="method">
<dt id="drivers.nrf_rtc.RTC.set_localtime">
<code class="sig-name descname">set_localtime</code><span class="sig-paren">(</span><em class="sig-param">t</em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.nrf_rtc.RTC.set_localtime" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the current wall time.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>t</strong> (<em>sequence</em>) – Wall time formatted as (yyyy, mm, dd, HH, MM, SS), any
additional elements in sequence will be ignored.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="drivers.nrf_rtc.RTC.update">
<code class="sig-name descname">update</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#drivers.nrf_rtc.RTC.update" title="Permalink to this definition">¶</a></dt>
<dd><p>Check for counter updates.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>True of the wall time has changed, False otherwise.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="drivers.nrf_rtc.RTC.uptime">
<em class="property">property </em><code class="sig-name descname">uptime</code><a class="headerlink" href="#drivers.nrf_rtc.RTC.uptime" title="Permalink to this definition">¶</a></dt>
<dd><p>Provide the current uptime in seconds.</p>
</dd></dl>

</dd></dl>

</div>
<span class="target" id="module-drivers.signal"></span><div class="section" id="inverting-pin-wrapper">
<h3><a class="toc-backref" href="#id10">Inverting pin wrapper</a><a class="headerlink" href="#inverting-pin-wrapper" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="drivers.signal.Signal">
<em class="property">class </em><code class="sig-prename descclassname">drivers.signal.</code><code class="sig-name descname">Signal</code><span class="sig-paren">(</span><em class="sig-param">pin</em>, <em class="sig-param">invert=False</em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.signal.Signal" title="Permalink to this definition">¶</a></dt>
<dd><p>Simplified Signal class</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The normal C implementation of the Signal class used by MicroPython
doesn’t work on the nRF family. This class provides a temporary
workaround until that can be addressed.</p>
</div>
<dl class="method">
<dt id="drivers.signal.Signal.__init__">
<code class="sig-name descname">__init__</code><span class="sig-paren">(</span><em class="sig-param">pin</em>, <em class="sig-param">invert=False</em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.signal.Signal.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a Signal object by wrapping a pin.</p>
</dd></dl>

<dl class="method">
<dt id="drivers.signal.Signal.off">
<code class="sig-name descname">off</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#drivers.signal.Signal.off" title="Permalink to this definition">¶</a></dt>
<dd><p>Deactivate the signal.</p>
</dd></dl>

<dl class="method">
<dt id="drivers.signal.Signal.on">
<code class="sig-name descname">on</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#drivers.signal.Signal.on" title="Permalink to this definition">¶</a></dt>
<dd><p>Activate the signal.</p>
</dd></dl>

<dl class="method">
<dt id="drivers.signal.Signal.value">
<code class="sig-name descname">value</code><span class="sig-paren">(</span><em class="sig-param">v=None</em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.signal.Signal.value" title="Permalink to this definition">¶</a></dt>
<dd><p>Get or set the state of the signal.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>v</strong> – Value to set, defaults to None (which means get the signal
state instead.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The state of the signal if v is None, otherwise None.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<span class="target" id="module-drivers.st7789"></span><div class="section" id="sitronix-st7789-display-driver">
<h3><a class="toc-backref" href="#id11">Sitronix ST7789 display driver</a><a class="headerlink" href="#sitronix-st7789-display-driver" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Although the ST7789 supports a variety of communication protocols currently
this driver only has support for SPI interfaces. However it is structured
such that other serial protocols can easily be added.</p>
</div>
<dl class="class">
<dt id="drivers.st7789.ST7789">
<em class="property">class </em><code class="sig-prename descclassname">drivers.st7789.</code><code class="sig-name descname">ST7789</code><span class="sig-paren">(</span><em class="sig-param">width</em>, <em class="sig-param">height</em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.st7789.ST7789" title="Permalink to this definition">¶</a></dt>
<dd><p>Sitronix ST7789 display driver</p>
<dl class="method">
<dt id="drivers.st7789.ST7789.__init__">
<code class="sig-name descname">__init__</code><span class="sig-paren">(</span><em class="sig-param">width</em>, <em class="sig-param">height</em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.st7789.ST7789.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>Configure the size of the display.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>width</strong> (<em>int</em>) – Display width, in pixels</p></li>
<li><p><strong>height</strong> (<em>int</em>) – Display height in pixels</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="drivers.st7789.ST7789.fill">
<code class="sig-name descname">fill</code><span class="sig-paren">(</span><em class="sig-param">bg</em>, <em class="sig-param">x=0</em>, <em class="sig-param">y=0</em>, <em class="sig-param">w=None</em>, <em class="sig-param">h=None</em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.st7789.ST7789.fill" title="Permalink to this definition">¶</a></dt>
<dd><p>Draw a solid colour rectangle.</p>
<p>If no arguments a provided the whole display will be filled with
the background colour (typically black).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>bg</strong> – Background colour (in RGB565 format)</p></li>
<li><p><strong>x</strong> – X coordinate of the left-most pixels of the rectangle</p></li>
<li><p><strong>y</strong> – Y coordinate of the top-most pixels of the rectangle</p></li>
<li><p><strong>w</strong> – Width of the rectangle, defaults to None (which means select
the right-most pixel of the display)</p></li>
<li><p><strong>h</strong> – Height of the rectangle, defaults to None (which means select
the bottom-most pixel of the display)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="drivers.st7789.ST7789.init_display">
<code class="sig-name descname">init_display</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#drivers.st7789.ST7789.init_display" title="Permalink to this definition">¶</a></dt>
<dd><p>Reset and initialize the display.</p>
</dd></dl>

<dl class="method">
<dt id="drivers.st7789.ST7789.invert">
<code class="sig-name descname">invert</code><span class="sig-paren">(</span><em class="sig-param">invert</em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.st7789.ST7789.invert" title="Permalink to this definition">¶</a></dt>
<dd><p>Invert the display.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>invert</strong> (<em>bool</em>) – True to invert the display, False for normal mode.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="drivers.st7789.ST7789.mute">
<code class="sig-name descname">mute</code><span class="sig-paren">(</span><em class="sig-param">mute</em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.st7789.ST7789.mute" title="Permalink to this definition">¶</a></dt>
<dd><p>Mute the display.</p>
<p>When muted the display will be entirely black.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>mute</strong> (<em>bool</em>) – True to mute the display, False for normal mode.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="drivers.st7789.ST7789.poweroff">
<code class="sig-name descname">poweroff</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#drivers.st7789.ST7789.poweroff" title="Permalink to this definition">¶</a></dt>
<dd><p>Put the display into sleep mode.</p>
</dd></dl>

<dl class="method">
<dt id="drivers.st7789.ST7789.poweron">
<code class="sig-name descname">poweron</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#drivers.st7789.ST7789.poweron" title="Permalink to this definition">¶</a></dt>
<dd><p>Wake the display and leave sleep mode.</p>
</dd></dl>

<dl class="method">
<dt id="drivers.st7789.ST7789.rawblit">
<code class="sig-name descname">rawblit</code><span class="sig-paren">(</span><em class="sig-param">buf</em>, <em class="sig-param">x</em>, <em class="sig-param">y</em>, <em class="sig-param">width</em>, <em class="sig-param">height</em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.st7789.ST7789.rawblit" title="Permalink to this definition">¶</a></dt>
<dd><p>Blit raw pixels to the display.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>buf</strong> – Pixel buffer</p></li>
<li><p><strong>x</strong> – X coordinate of the left-most pixels of the rectangle</p></li>
<li><p><strong>y</strong> – Y coordinate of the top-most pixels of the rectangle</p></li>
<li><p><strong>w</strong> – Width of the rectangle, defaults to None (which means select
the right-most pixel of the display)</p></li>
<li><p><strong>h</strong> – Height of the rectangle, defaults to None (which means select
the bottom-most pixel of the display)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="drivers.st7789.ST7789.set_window">
<code class="sig-name descname">set_window</code><span class="sig-paren">(</span><em class="sig-param">x=0</em>, <em class="sig-param">y=0</em>, <em class="sig-param">width=None</em>, <em class="sig-param">height=None</em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.st7789.ST7789.set_window" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the clipping rectangle.</p>
<p>All writes to the display will be wrapped at the edges of the rectangle.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> – X coordinate of the left-most pixels of the rectangle</p></li>
<li><p><strong>y</strong> – Y coordinate of the top-most pixels of the rectangle</p></li>
<li><p><strong>w</strong> – Width of the rectangle, defaults to None (which means select
the right-most pixel of the display)</p></li>
<li><p><strong>h</strong> – Height of the rectangle, defaults to None (which means select
the bottom-most pixel of the display)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="drivers.st7789.ST7789_SPI">
<em class="property">class </em><code class="sig-prename descclassname">drivers.st7789.</code><code class="sig-name descname">ST7789_SPI</code><span class="sig-paren">(</span><em class="sig-param">width</em>, <em class="sig-param">height</em>, <em class="sig-param">spi</em>, <em class="sig-param">cs</em>, <em class="sig-param">dc</em>, <em class="sig-param">res=None</em>, <em class="sig-param">rate=8000000</em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.st7789.ST7789_SPI" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="drivers.st7789.ST7789_SPI.quick_write">
<code class="sig-name descname">quick_write</code><span class="sig-paren">(</span><em class="sig-param">buf</em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.st7789.ST7789_SPI.quick_write" title="Permalink to this definition">¶</a></dt>
<dd><p>Send data to the display as part of an optimized write sequence.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>buf</strong> (<em>bytearray</em>) – Data, must be in a form that can be directly
consumed by the SPI bus.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="drivers.st7789.ST7789_SPI.quick_end">
<code class="sig-name descname">quick_end</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#drivers.st7789.ST7789_SPI.quick_end" title="Permalink to this definition">¶</a></dt>
<dd><p>Complete an optimized write sequence.</p>
</dd></dl>

<dl class="method">
<dt id="drivers.st7789.ST7789_SPI.quick_start">
<code class="sig-name descname">quick_start</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#drivers.st7789.ST7789_SPI.quick_start" title="Permalink to this definition">¶</a></dt>
<dd><p>Prepare for an optimized write sequence.</p>
<p>Optimized write sequences allow applications to produce data in chunks
without having any overhead managing the chip select.</p>
</dd></dl>

<dl class="method">
<dt id="drivers.st7789.ST7789_SPI.reset">
<code class="sig-name descname">reset</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#drivers.st7789.ST7789_SPI.reset" title="Permalink to this definition">¶</a></dt>
<dd><p>Reset the display.</p>
<p>Uses the hardware reset pin if there is one, otherwise it will issue
a software reset command.</p>
</dd></dl>

<dl class="method">
<dt id="drivers.st7789.ST7789_SPI.write_cmd">
<code class="sig-name descname">write_cmd</code><span class="sig-paren">(</span><em class="sig-param">cmd</em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.st7789.ST7789_SPI.write_cmd" title="Permalink to this definition">¶</a></dt>
<dd><p>Send a command opcode to the display.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>cmd</strong> (<em>sequence</em>) – Command, will be automatically converted so it can
be issued to the SPI bus.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="drivers.st7789.ST7789_SPI.write_data">
<code class="sig-name descname">write_data</code><span class="sig-paren">(</span><em class="sig-param">buf</em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.st7789.ST7789_SPI.write_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Send data to the display.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>buf</strong> (<em>bytearray</em>) – Data, must be in a form that can be directly
consumed by the SPI bus.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<span class="target" id="module-drivers.vibrator"></span><div class="section" id="generic-pwm-capable-vibration-motor-driver">
<h3><a class="toc-backref" href="#id12">Generic PWM capable vibration motor driver</a><a class="headerlink" href="#generic-pwm-capable-vibration-motor-driver" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="drivers.vibrator.Vibrator">
<em class="property">class </em><code class="sig-prename descclassname">drivers.vibrator.</code><code class="sig-name descname">Vibrator</code><span class="sig-paren">(</span><em class="sig-param">pin</em>, <em class="sig-param">active_low=False</em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.vibrator.Vibrator" title="Permalink to this definition">¶</a></dt>
<dd><p>Vibration motor driver.</p>
<dl class="method">
<dt id="drivers.vibrator.Vibrator.__init__">
<code class="sig-name descname">__init__</code><span class="sig-paren">(</span><em class="sig-param">pin</em>, <em class="sig-param">active_low=False</em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.vibrator.Vibrator.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>Specify the pin and configuration used to operate the motor.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>pin</strong> (<em>machine.Pin</em>) – The PWM-capable pin used to driver the
vibration motor.</p></li>
<li><p><strong>active_low</strong> (<em>bool</em>) – Invert the resting state of the motor.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="drivers.vibrator.Vibrator.pulse">
<code class="sig-name descname">pulse</code><span class="sig-paren">(</span><em class="sig-param">duty=25</em>, <em class="sig-param">ms=40</em><span class="sig-paren">)</span><a class="headerlink" href="#drivers.vibrator.Vibrator.pulse" title="Permalink to this definition">¶</a></dt>
<dd><p>Briefly pulse the motor.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>duty</strong> (<em>int</em>) – Duty cycle, in percent.</p></li>
<li><p><strong>ms</strong> (<em>int</em>) – Duration, in milliseconds.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="module-apps.clock">
<span id="applications"></span><h2><a class="toc-backref" href="#id13">Applications</a><a class="headerlink" href="#module-apps.clock" title="Permalink to this headline">¶</a></h2>
<div class="section" id="digital-clock">
<h3><a class="toc-backref" href="#id14">Digital clock</a><a class="headerlink" href="#digital-clock" title="Permalink to this headline">¶</a></h3>
<p>Shows a time (as HH:MM) together with a battery meter and the date.</p>
<dl class="class">
<dt id="apps.clock.ClockApp">
<em class="property">class </em><code class="sig-prename descclassname">apps.clock.</code><code class="sig-name descname">ClockApp</code><a class="headerlink" href="#apps.clock.ClockApp" title="Permalink to this definition">¶</a></dt>
<dd><p>Simple digital clock application.</p>
<dl class="attribute">
<dt id="apps.clock.ClockApp.ICON">
<code class="sig-name descname">ICON</code><em class="property"> = 'Default digital clock icon'</em><a class="headerlink" href="#apps.clock.ClockApp.ICON" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="apps.clock.ClockApp.NAME">
<code class="sig-name descname">NAME</code><em class="property"> = 'Clock'</em><a class="headerlink" href="#apps.clock.ClockApp.NAME" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="apps.clock.ClockApp.draw">
<code class="sig-name descname">draw</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#apps.clock.ClockApp.draw" title="Permalink to this definition">¶</a></dt>
<dd><p>Redraw the display from scratch.</p>
</dd></dl>

<dl class="method">
<dt id="apps.clock.ClockApp.foreground">
<code class="sig-name descname">foreground</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#apps.clock.ClockApp.foreground" title="Permalink to this definition">¶</a></dt>
<dd><p>Activate the application.</p>
</dd></dl>

<dl class="method">
<dt id="apps.clock.ClockApp.sleep">
<code class="sig-name descname">sleep</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#apps.clock.ClockApp.sleep" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="apps.clock.ClockApp.tick">
<code class="sig-name descname">tick</code><span class="sig-paren">(</span><em class="sig-param">ticks</em><span class="sig-paren">)</span><a class="headerlink" href="#apps.clock.ClockApp.tick" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="apps.clock.ClockApp.update">
<code class="sig-name descname">update</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#apps.clock.ClockApp.update" title="Permalink to this definition">¶</a></dt>
<dd><p>Update the display (if needed).</p>
<p>The updates are a lazy as possible and rely on an prior call to
draw() to ensure the screen is suitably prepared.</p>
</dd></dl>

<dl class="method">
<dt id="apps.clock.ClockApp.wake">
<code class="sig-name descname">wake</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#apps.clock.ClockApp.wake" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</div>
<span class="target" id="module-apps.flashlight"></span><div class="section" id="flashlight">
<h3><a class="toc-backref" href="#id15">Flashlight</a><a class="headerlink" href="#flashlight" title="Permalink to this headline">¶</a></h3>
<p>Shows a pure white screen with the backlight set to maximum.</p>
<dl class="class">
<dt id="apps.flashlight.FlashlightApp">
<em class="property">class </em><code class="sig-prename descclassname">apps.flashlight.</code><code class="sig-name descname">FlashlightApp</code><a class="headerlink" href="#apps.flashlight.FlashlightApp" title="Permalink to this definition">¶</a></dt>
<dd><p>Trivial flashlight application.</p>
<dl class="attribute">
<dt id="apps.flashlight.FlashlightApp.ICON">
<code class="sig-name descname">ICON</code><em class="property"> = 'Default torch or flashlight icon'</em><a class="headerlink" href="#apps.flashlight.FlashlightApp.ICON" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="apps.flashlight.FlashlightApp.NAME">
<code class="sig-name descname">NAME</code><em class="property"> = 'Torch'</em><a class="headerlink" href="#apps.flashlight.FlashlightApp.NAME" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="apps.flashlight.FlashlightApp.background">
<code class="sig-name descname">background</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#apps.flashlight.FlashlightApp.background" title="Permalink to this definition">¶</a></dt>
<dd><p>De-activate the application (without losing state).</p>
</dd></dl>

<dl class="method">
<dt id="apps.flashlight.FlashlightApp.draw">
<code class="sig-name descname">draw</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#apps.flashlight.FlashlightApp.draw" title="Permalink to this definition">¶</a></dt>
<dd><p>Redraw the display from scratch.</p>
</dd></dl>

<dl class="method">
<dt id="apps.flashlight.FlashlightApp.foreground">
<code class="sig-name descname">foreground</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#apps.flashlight.FlashlightApp.foreground" title="Permalink to this definition">¶</a></dt>
<dd><p>Activate the application.</p>
</dd></dl>

<dl class="method">
<dt id="apps.flashlight.FlashlightApp.tick">
<code class="sig-name descname">tick</code><span class="sig-paren">(</span><em class="sig-param">ticks</em><span class="sig-paren">)</span><a class="headerlink" href="#apps.flashlight.FlashlightApp.tick" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</div>
<span class="target" id="module-apps.launcher"></span><div class="section" id="application-launcher">
<h3><a class="toc-backref" href="#id16">Application launcher</a><a class="headerlink" href="#application-launcher" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="apps.launcher.LauncherApp">
<em class="property">class </em><code class="sig-prename descclassname">apps.launcher.</code><code class="sig-name descname">LauncherApp</code><a class="headerlink" href="#apps.launcher.LauncherApp" title="Permalink to this definition">¶</a></dt>
<dd><p>An application launcher application.</p>
<dl class="attribute">
<dt id="apps.launcher.LauncherApp.ICON">
<code class="sig-name descname">ICON</code><em class="property"> = 'Default application icon'</em><a class="headerlink" href="#apps.launcher.LauncherApp.ICON" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="apps.launcher.LauncherApp.NAME">
<code class="sig-name descname">NAME</code><em class="property"> = 'Launcher'</em><a class="headerlink" href="#apps.launcher.LauncherApp.NAME" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="apps.launcher.LauncherApp.foreground">
<code class="sig-name descname">foreground</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#apps.launcher.LauncherApp.foreground" title="Permalink to this definition">¶</a></dt>
<dd><p>Activate the application.</p>
</dd></dl>

<dl class="method">
<dt id="apps.launcher.LauncherApp.swipe">
<code class="sig-name descname">swipe</code><span class="sig-paren">(</span><em class="sig-param">event</em><span class="sig-paren">)</span><a class="headerlink" href="#apps.launcher.LauncherApp.swipe" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="apps.launcher.LauncherApp.touch">
<code class="sig-name descname">touch</code><span class="sig-paren">(</span><em class="sig-param">event</em><span class="sig-paren">)</span><a class="headerlink" href="#apps.launcher.LauncherApp.touch" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</div>
<span class="target" id="module-apps.pager"></span><div class="section" id="pager-applications">
<h3><a class="toc-backref" href="#id17">Pager applications</a><a class="headerlink" href="#pager-applications" title="Permalink to this headline">¶</a></h3>
<p>The pager is used to present text based information to the user. It is
primarily intended for notifications but is also used to provide debugging
information when applications crash.</p>
<dl class="class">
<dt id="apps.pager.CrashApp">
<em class="property">class </em><code class="sig-prename descclassname">apps.pager.</code><code class="sig-name descname">CrashApp</code><span class="sig-paren">(</span><em class="sig-param">exc</em><span class="sig-paren">)</span><a class="headerlink" href="#apps.pager.CrashApp" title="Permalink to this definition">¶</a></dt>
<dd><p>Crash handler application.</p>
<p>This application is launched automatically whenever another
application crashes. Our main job it to indicate as loudly as
possible that the system is no longer running correctly. This
app deliberately enables inverted video mode in order to deliver
that message as strongly as possible.</p>
<dl class="method">
<dt id="apps.pager.CrashApp.background">
<code class="sig-name descname">background</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#apps.pager.CrashApp.background" title="Permalink to this definition">¶</a></dt>
<dd><p>Restore a normal display mode.</p>
<p>Conceal the display before the transition otherwise the inverted
bombs get noticed by the user.</p>
</dd></dl>

<dl class="method">
<dt id="apps.pager.CrashApp.foreground">
<code class="sig-name descname">foreground</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#apps.pager.CrashApp.foreground" title="Permalink to this definition">¶</a></dt>
<dd><p>Indicate the system has crashed by drawing a couple of bomb icons.</p>
<p>If you owned an Atari ST back in the mid-eighties then I hope you
recognise this as a tribute a long forgotten home computer!</p>
</dd></dl>

<dl class="method">
<dt id="apps.pager.CrashApp.swipe">
<code class="sig-name descname">swipe</code><span class="sig-paren">(</span><em class="sig-param">event</em><span class="sig-paren">)</span><a class="headerlink" href="#apps.pager.CrashApp.swipe" title="Permalink to this definition">¶</a></dt>
<dd><p>Show the exception message in a pager.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="apps.pager.PagerApp">
<em class="property">class </em><code class="sig-prename descclassname">apps.pager.</code><code class="sig-name descname">PagerApp</code><span class="sig-paren">(</span><em class="sig-param">msg</em><span class="sig-paren">)</span><a class="headerlink" href="#apps.pager.PagerApp" title="Permalink to this definition">¶</a></dt>
<dd><p>Show a long text message in a pager.</p>
<dl class="attribute">
<dt id="apps.pager.PagerApp.ICON">
<code class="sig-name descname">ICON</code><em class="property"> = 'Default application icon'</em><a class="headerlink" href="#apps.pager.PagerApp.ICON" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="apps.pager.PagerApp.NAME">
<code class="sig-name descname">NAME</code><em class="property"> = 'Pager'</em><a class="headerlink" href="#apps.pager.PagerApp.NAME" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="apps.pager.PagerApp.background">
<code class="sig-name descname">background</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#apps.pager.PagerApp.background" title="Permalink to this definition">¶</a></dt>
<dd><p>De-activate the application.</p>
</dd></dl>

<dl class="method">
<dt id="apps.pager.PagerApp.foreground">
<code class="sig-name descname">foreground</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#apps.pager.PagerApp.foreground" title="Permalink to this definition">¶</a></dt>
<dd><p>Activate the application.</p>
</dd></dl>

<dl class="method">
<dt id="apps.pager.PagerApp.swipe">
<code class="sig-name descname">swipe</code><span class="sig-paren">(</span><em class="sig-param">event</em><span class="sig-paren">)</span><a class="headerlink" href="#apps.pager.PagerApp.swipe" title="Permalink to this definition">¶</a></dt>
<dd><p>Swipe to page up/down.</p>
</dd></dl>

</dd></dl>

</div>
<span class="target" id="module-apps.testapp"></span><div class="section" id="self-tests">
<h3><a class="toc-backref" href="#id18">Self Tests</a><a class="headerlink" href="#self-tests" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="apps.testapp.TestApp">
<em class="property">class </em><code class="sig-prename descclassname">apps.testapp.</code><code class="sig-name descname">TestApp</code><a class="headerlink" href="#apps.testapp.TestApp" title="Permalink to this definition">¶</a></dt>
<dd><p>Simple test application.</p>
<dl class="attribute">
<dt id="apps.testapp.TestApp.ICON">
<code class="sig-name descname">ICON</code><em class="property"> = 'Default application icon'</em><a class="headerlink" href="#apps.testapp.TestApp.ICON" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="apps.testapp.TestApp.NAME">
<code class="sig-name descname">NAME</code><em class="property"> = 'Self Test'</em><a class="headerlink" href="#apps.testapp.TestApp.NAME" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="apps.testapp.TestApp.foreground">
<code class="sig-name descname">foreground</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#apps.testapp.TestApp.foreground" title="Permalink to this definition">¶</a></dt>
<dd><p>Activate the application.</p>
</dd></dl>

<dl class="method">
<dt id="apps.testapp.TestApp.press">
<code class="sig-name descname">press</code><span class="sig-paren">(</span><em class="sig-param">button</em>, <em class="sig-param">state</em><span class="sig-paren">)</span><a class="headerlink" href="#apps.testapp.TestApp.press" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="apps.testapp.TestApp.swipe">
<code class="sig-name descname">swipe</code><span class="sig-paren">(</span><em class="sig-param">event</em><span class="sig-paren">)</span><a class="headerlink" href="#apps.testapp.TestApp.swipe" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="apps.testapp.TestApp.touch">
<code class="sig-name descname">touch</code><span class="sig-paren">(</span><em class="sig-param">event</em><span class="sig-paren">)</span><a class="headerlink" href="#apps.testapp.TestApp.touch" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="bootloader">
<h2><a class="toc-backref" href="#id19">Bootloader</a><a class="headerlink" href="#bootloader" title="Permalink to this headline">¶</a></h2>
<p>The bootloader implements a couple of protocols that allow the bootloader
and payload to communicate during a reset or on handover from bootloader
to application.</p>
<div class="section" id="gpregret-protocol">
<h3><a class="toc-backref" href="#id20">GPREGRET protocol</a><a class="headerlink" href="#gpregret-protocol" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">GPREGRET</span></code> is a general purpose 8-bit retention register that is preserved
in all power states of the nRF52 (including System OFF mode when SRAM
content is destroyed).</p>
<p>It can be used by the application to request specific bootloader behaviours
during a reset:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 22%" />
<col style="width: 7%" />
<col style="width: 71%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Name</p></td>
<td><p>Value</p></td>
<td><p>Description</p></td>
</tr>
<tr class="row-even"><td><p>OTA_APPJUM</p></td>
<td><p>0xb1</p></td>
<td><p>Bootloader entered (without reset) from application.</p></td>
</tr>
<tr class="row-odd"><td><p>OTA_RESET</p></td>
<td><p>0xa8</p></td>
<td><p>Enter OTA (Bluetooth) recovery mode</p></td>
</tr>
<tr class="row-even"><td><p>SERIAL_ONLY_RESET</p></td>
<td><p>0x4e</p></td>
<td><p>Enter UART recovery mode (if applicable)</p></td>
</tr>
<tr class="row-odd"><td><p>UF2_RESET</p></td>
<td><p>0x57</p></td>
<td><p>Enter USB recovery mode (if applicable)</p></td>
</tr>
<tr class="row-even"><td><p>FORCE_APP_BOOT</p></td>
<td><p>0x65</p></td>
<td><p>Force direct application boot (no splash screen)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="pnvram-protocol">
<h3><a class="toc-backref" href="#id21">PNVRAM protocol</a><a class="headerlink" href="#pnvram-protocol" title="Permalink to this headline">¶</a></h3>
<p>The pseudo non-volatile RAM is a small block of regular static RAM that,
once initialized, can be used to share information.</p>
<p>The PNVRAM starts at 0x200039c0 and is 32 bytes long.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 13%" />
<col style="width: 87%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Address</p></td>
<td><p>Description</p></td>
</tr>
<tr class="row-even"><td><p>0x200039c0</p></td>
<td><p>Guard value. Must be set to 0x1abe11ed .</p></td>
</tr>
<tr class="row-odd"><td><p>0x200039c4</p></td>
<td><p>Course grained RTC value (bootloader must preserve but can ignore).</p></td>
</tr>
<tr class="row-even"><td><p>0x200039c8</p></td>
<td><p>RTC millisecond counter (bootloader must increment this).</p></td>
</tr>
<tr class="row-odd"><td><p>0x200039cc</p></td>
<td><p>Reserved</p></td>
</tr>
<tr class="row-even"><td><p>0x200039d0</p></td>
<td><p>Reserved</p></td>
</tr>
<tr class="row-odd"><td><p>0x200039d4</p></td>
<td><p>Reserved</p></td>
</tr>
<tr class="row-even"><td><p>0x200039d8</p></td>
<td><p>Reserved</p></td>
</tr>
<tr class="row-odd"><td><p>0x200039cc</p></td>
<td><p>Guard value. Must be set to 0x10adab1e .</p></td>
</tr>
</tbody>
</table>
<p>Note: <em>The PNVRAM protocol allows up to 28 bytes to be transfered (compared to
2 bytes via GPREGRET and GPREGRET2) but it is less versatile. For example
FORCE_APP_BOOT cannot be implmented using PNVRAM.</em></p>
<p>The RTC millisecond counter is incremented whenever the bootloader is
active (during splash screen or early UART recovery mode, during an
update). It can be consumed by the application to prevent the current
time being lost during an update.</p>
</div>
<div class="section" id="watchdog-protocol">
<h3><a class="toc-backref" href="#id22">Watchdog protocol</a><a class="headerlink" href="#watchdog-protocol" title="Permalink to this headline">¶</a></h3>
<p>Form-factor devices such as smart watches and fitness trackers do not usually
have any hardware mechanism to allow the user to force a failed device into
bootloader mode. This makes them difficult to develop on because opening the
case to access a SWD or reset pins may compromise their waterproofing.</p>
<p>WASP uses a watchdog timer (WDT) combined with a single hardware button in
order to provide a robust mechanism to allow the user to force entry into a
over-the-air firmware recovery mode that allows the buggy application to be
replaced.</p>
<p>The software responsibilities to implement this are split between the
bootloader and the application, although the application responsibilities
are intentionally minimal.</p>
<p>The bootloader implements an over-the-air recovery mode, as well as handling
normal boot, where it’s role is to display the splash screen.</p>
<p>Additionally the bootloader implements several watchdog related features
necessary for robust reboot handling:</p>
<ol class="arabic simple">
<li><p>The bootloader configures the watchdog prior to booting the main
application. This is a simple, single channel reload request, watchdog
with a 5 second timeout.</p></li>
<li><p>The bootloader checks the reset reason prior too booting the main
application. If it detects a watchdog reset the bootloader switches
automatically to DFU mode.</p></li>
<li><p>The bootlaoder initialized the pinmux allowing the hardware button
state to be observed.</p></li>
<li><p>The bootloader monitors the hardware button and switches back to the main
application when it is pressed.</p></li>
</ol>
<p>From this list #1 and #2 are needed to ensure robust WDT handling whilst #3
and # 4 ensure the user can switch back to application from the device
itself if they ever accidentally trigger entry to recovery mode.</p>
<p>The application’s role is to carefully pet the watchdog so that it will
trigger automatically if the hardware button is held down for five
seconds. Key points for application robustness include:</p>
<ol class="arabic simple">
<li><p>Unlike a normal watchdog we can be fairly reckless about where in the
code we pet the dog. For example petting the dog from a timer interrupt
is fine because we only need the dog to bark if the hardware button is
pressed.</p></li>
<li><p>The routine to pet the dog is predicated on the hardware button not
being pressed.</p></li>
<li><p>The routine to pet the dog is also predicated on the hardware button
still being correctly configured.</p></li>
</ol>
<p>To avoid mistakes the application should contain no subroutines that
unconditionally pet the dog; they should all implement #2 and #3 from
the above list.</p>
<p>Note: <em>nRF52 microcontrollers implement a distributed pin-muxing
mechanism meaning most peripheral can acidentally “steal” a pin
if the pin is requested by the peripheral. This requires a fully
robust implementation of #3 to visit the PSEL registers of every
peripheral that can control pins. The code currently used in
wasp-os does not yet meet this criteria.</em></p>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">WASP-OS</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="README.html">Watch Application System in Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="appguide.html">Application Writer’s Guide</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">WASP Reference Manual</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#module-wasp">System</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-drivers.battery">Device drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-apps.clock">Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="#bootloader">Bootloader</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="TODO.html">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">Licensing</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="appguide.html" title="previous chapter">Application Writer’s Guide</a></li>
      <li>Next: <a href="TODO.html" title="next chapter">Roadmap</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Daniel Thompson.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.2.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/wasp.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>