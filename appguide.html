
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Application Writer’s Guide &#8212; WASP-OS  documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Wasp-os Reference Manual" href="wasp.html" />
    <link rel="prev" title="Watch Application System in Python" href="README.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="application-writer-s-guide">
<h1>Application Writer’s Guide<a class="headerlink" href="#application-writer-s-guide" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#introduction" id="id5">Introduction</a></p>
<ul>
<li><p><a class="reference internal" href="#hello-world-for-wasp-os" id="id6">Hello World for wasp-os</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#application-life-cycle" id="id7">Application life-cycle</a></p></li>
<li><p><a class="reference internal" href="#api-primer" id="id8">API primer</a></p>
<ul>
<li><p><a class="reference internal" href="#system-management" id="id9">System management</a></p></li>
<li><p><a class="reference internal" href="#drawing" id="id10">Drawing</a></p></li>
<li><p><a class="reference internal" href="#micropython" id="id11">MicroPython</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#how-to-run-your-application" id="id12">How to run your application</a></p>
<ul>
<li><p><a class="reference internal" href="#testing-on-the-simulator" id="id13">Testing on the simulator</a></p></li>
<li><p><a class="reference internal" href="#testing-on-the-device" id="id14">Testing on the device</a></p></li>
<li><p><a class="reference internal" href="#making-it-permanent" id="id15">Making it permanent</a></p></li>
<li><p><a class="reference internal" href="#freezing-your-application-into-the-wasp-os-binary" id="id16">Freezing your application into the wasp-os binary</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#application-entry-points" id="id17">Application entry points</a></p></li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id5">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Wasp-os, the Watch Application System in Python, has one pervasive goal that
influences almost everything about it, from its name to its development
roadmap: make writing applications easy (and fun).</p>
<p>Applications that can be loaded, changed, adapted and remixed by the user
are what <strong>really</strong> distinguishes a smart watch from a “feature watch”<a class="footnote-reference brackets" href="#id2" id="id1">1</a>.
In other words if we want a watch built around a tiny microcontroller to be
sufficiently “smart” then it has to be all about the applications.</p>
<p>This guide will help you get started writing applications for wasp-os. Have fun!</p>
<dl class="footnote brackets">
<dt class="label" id="id2"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>The fixed function mobile phones that existed before iOS and Android
took over the industry were retrospectively renamed “feature phones” to
distinguish them from newer devices. Many of them were superficially similar
to early Android devices but is was the application ecosystem that really
made smart phones smart.</p>
</dd>
</dl>
<div class="section" id="hello-world-for-wasp-os">
<h3><a class="toc-backref" href="#id6">Hello World for wasp-os</a><a class="headerlink" href="#hello-world-for-wasp-os" title="Permalink to this headline">¶</a></h3>
<p>Let’s start by examining a simple “Hello, World!” application for wasp-os.</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># SPDX-License-Identifier: MY-LICENSE</span>
<span class="c1"># Copyright (C) YEAR(S), AUTHOR</span>

<span class="kn">import</span> <span class="nn">wasp</span>

<span class="k">class</span> <span class="nc">HelloApp</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;A hello world application for wasp-os.&quot;&quot;&quot;</span>
    <span class="n">NAME</span> <span class="o">=</span> <span class="s2">&quot;Hello&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Hello, world!&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span>

    <span class="k">def</span> <span class="nf">foreground</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_draw</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_draw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">draw</span> <span class="o">=</span> <span class="n">wasp</span><span class="o">.</span><span class="n">watch</span><span class="o">.</span><span class="n">drawable</span>
        <span class="n">draw</span><span class="o">.</span><span class="n">fill</span><span class="p">()</span>
        <span class="n">draw</span><span class="o">.</span><span class="n">string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">240</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>There are a couple of points of interest:</p>
<ol class="arabic simple">
<li><p>Applications have a <code class="xref py py-attr docutils literal notranslate"><span class="pre">NAME</span></code>, which is shown in the
launcher. Most applications also provide an <code class="xref py py-attr docutils literal notranslate"><span class="pre">ICON</span></code>
but a default is displayed if this is omitted.</p></li>
<li><p>This example uses <a class="reference internal" href="#apps.template.TemplateApp.__init__" title="apps.template.TemplateApp.__init__"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__init__()</span></code></a> to initialize
the state of the application, this ensure the state remains “sticky”
when the application is activated and deactivated.</p></li>
<li><p><a class="reference internal" href="#apps.template.TemplateApp.foreground" title="apps.template.TemplateApp.foreground"><code class="xref py py-meth docutils literal notranslate"><span class="pre">foreground()</span></code></a> is the only mandatory application entry
point and is responsible for redrawing the screen. This application does
not implement <a class="reference internal" href="#apps.template.TemplateApp.background" title="apps.template.TemplateApp.background"><code class="xref py py-meth docutils literal notranslate"><span class="pre">background()</span></code></a> because there is nothing
for us to do!</p></li>
<li><p>The use of <a class="reference internal" href="#apps.template.TemplateApp._draw" title="apps.template.TemplateApp._draw"><code class="xref py py-meth docutils literal notranslate"><span class="pre">_draw()</span></code></a> is optional. We could just do
the work in <a class="reference internal" href="#apps.template.TemplateApp.foreground" title="apps.template.TemplateApp.foreground"><code class="xref py py-meth docutils literal notranslate"><span class="pre">foreground()</span></code></a> but this application follows
a common wasp-os idiom that is normally used to pattern to distinguish a full
refresh of the screen from an fast update (a redraw).</p></li>
</ol>
</div>
</div>
<div class="section" id="application-life-cycle">
<h2><a class="toc-backref" href="#id7">Application life-cycle</a><a class="headerlink" href="#application-life-cycle" title="Permalink to this headline">¶</a></h2>
<p>Applications in wasp-os are triggered by and do all their processing
from calls their entry points. The entry points can be coarsely categorized
event notifications, timer callbacks (the application tick) and
system notifications.</p>
<p>System notifications control the application life-cycle and the entry point
calls, together with the implicit application states are shown below.</p>
<div class="graphviz"><img src="_images/graphviz-b70ea07f5316bcffa17b488873a57d7cfa2641ef.png" alt="digraph lifecycle {
    START -&gt; BACKGROUND [ label=&quot; __init__()   &quot; ];
    BACKGROUND -&gt; START [ label=&quot; __del__()   &quot; ];
    BACKGROUND -&gt; ACTIVE [ label=&quot; foreground()   &quot; ];
    ACTIVE -&gt; BACKGROUND [ label=&quot; background()   &quot; ];
    ACTIVE -&gt; GO_TO_CLOCK [ label=&quot; sleep() -&gt; False   &quot; ];
    GO_TO_CLOCK -&gt; BACKGROUND [ label=&quot; background()   &quot; ];
    ACTIVE -&gt; SLEEPING [ label=&quot; sleep() -&gt; True   &quot; ];
    SLEEPING -&gt; ACTIVE [ label=&quot; wake()   &quot; ];

    START [ shape=box ];
    BACKGROUND [ shape=box, style=rounded ]
    ACTIVE [ shape=box, style=rounded ]
    SLEEPING [ shape=box, style=rounded ]
    GO_TO_CLOCK [ label=&quot;GOTO ClockApp&quot; ];
}" class="graphviz" /></div>
<p>When an application is initialized is enters the <code class="docutils literal notranslate"><span class="pre">BACKGROUND</span></code> state. A
backgrounded application will not execute but it should nevertheless
maintain its user visible state whilst in the background. To conserve
memory wasp-os does not permit two applications to run simultaneously but
because each application preserves its state when in the background it will
appear to the user as though all applications are running all the time.</p>
<p>For example, a stopwatch application should record the time that it was started
and remember that start time, regardless of it’s state, until either the
stopwatch is stopped of the application is destroyed.</p>
<p>A backgrounded application can enter the <code class="docutils literal notranslate"><span class="pre">ACTIVE</span></code> state via a call to
<a class="reference internal" href="#apps.template.TemplateApp.foreground" title="apps.template.TemplateApp.foreground"><code class="xref py py-meth docutils literal notranslate"><span class="pre">foreground()</span></code></a>. When it is active the application owns the
screen and should draw and maintain its UI.</p>
<p>If the system manager want to put an active application to sleep then it will
call <a class="reference internal" href="#apps.template.TemplateApp.sleep" title="apps.template.TemplateApp.sleep"><code class="xref py py-meth docutils literal notranslate"><span class="pre">sleep()</span></code></a>. If the application returns True then the
application will stop running (e.g. receive no events and no application tick)
but instead must wait to receive a notification via
<a class="reference internal" href="#apps.template.TemplateApp.wake" title="apps.template.TemplateApp.wake"><code class="xref py py-meth docutils literal notranslate"><span class="pre">wake()</span></code></a> telling the application that the device
is waking up and that it may update the screen if needed.</p>
<p>If an application does not support sleeping then it can simply not implement
<a class="reference internal" href="#apps.template.TemplateApp.sleep" title="apps.template.TemplateApp.sleep"><code class="xref py py-meth docutils literal notranslate"><span class="pre">sleep()</span></code></a> (or <a class="reference internal" href="#apps.template.TemplateApp.wake" title="apps.template.TemplateApp.wake"><code class="xref py py-meth docutils literal notranslate"><span class="pre">wake()</span></code></a>) although it
can also return False from <a class="reference internal" href="#apps.template.TemplateApp.sleep" title="apps.template.TemplateApp.sleep"><code class="xref py py-meth docutils literal notranslate"><span class="pre">sleep()</span></code></a> if this is preferred.
In this case the system manager will automatically return to the default
application, typically the main clock face.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Most applications do not need to support <a class="reference internal" href="#apps.template.TemplateApp.sleep" title="apps.template.TemplateApp.sleep"><code class="xref py py-meth docutils literal notranslate"><span class="pre">sleep()</span></code></a>
since it is often a better user experience for the watch to return to the
default application when they complete an interaction.</p>
</div>
</div>
<div class="section" id="api-primer">
<h2><a class="toc-backref" href="#id8">API primer</a><a class="headerlink" href="#api-primer" title="Permalink to this headline">¶</a></h2>
<p>This API primer introduces some of the most important and frequently used
interfaces for wasp-os. For more comprehensive coverage see the
<a class="reference internal" href="wasp.html#wasp-os-reference-manual"><span class="std std-ref">Wasp-os Reference Manual</span></a> which contains extensive API documentation
covering the entire of wasp-os, including its drivers.</p>
<div class="section" id="system-management">
<h3><a class="toc-backref" href="#id9">System management</a><a class="headerlink" href="#system-management" title="Permalink to this headline">¶</a></h3>
<p>The system management API does provide a number of low-level calls that
can register new applications and navigate between them. However most
applications need not use these. Instead most applications use a small
set of methods. In particular almost all applictions need to call a couple of
methods from <a class="reference internal" href="#apps.template.TemplateApp.foreground" title="apps.template.TemplateApp.foreground"><code class="xref py py-meth docutils literal notranslate"><span class="pre">foreground()</span></code></a> in order to register
for notifications:</p>
<ul class="simple">
<li><p><a class="reference internal" href="wasp.html#wasp.Manager.request_event" title="wasp.Manager.request_event"><code class="xref py py-meth docutils literal notranslate"><span class="pre">request_event()</span></code></a> - register for UI events such as button
presses and touch screen activity.</p></li>
<li><p><a class="reference internal" href="wasp.html#wasp.Manager.request_tick" title="wasp.Manager.request_tick"><code class="xref py py-meth docutils literal notranslate"><span class="pre">request_tick()</span></code></a> - register to receive an application tick
and specify the tick frequency.</p></li>
</ul>
<p>Additionally if your application is a game or a similar program that should
not allow the watch to go to sleep then it should arrange to call
<a class="reference internal" href="wasp.html#wasp.Manager.keep_awake" title="wasp.Manager.keep_awake"><code class="xref py py-meth docutils literal notranslate"><span class="pre">keep_awake()</span></code></a> from the application’s
<a class="reference internal" href="#apps.template.TemplateApp.tick" title="apps.template.TemplateApp.tick"><code class="xref py py-meth docutils literal notranslate"><span class="pre">tick()</span></code></a> method.</p>
</div>
<div class="section" id="drawing">
<h3><a class="toc-backref" href="#id10">Drawing</a><a class="headerlink" href="#drawing" title="Permalink to this headline">¶</a></h3>
<p>Most applications using the drawing toolbox, <code class="xref py py-data docutils literal notranslate"><span class="pre">wasp.watch.drawable</span></code>,
in order to handle the display. Applications are permitted to directly access
<code class="xref py py-data docutils literal notranslate"><span class="pre">wasp.watch.display</span></code> if they require direct pixel access or want to
exploit specific features of the display hardware (inverse video, partial
display, etc) but for simple applications then the following simple drawing
functions are sufficient.</p>
<ul class="simple">
<li><p><a class="reference internal" href="wasp.html#draw565.Draw565.blit" title="draw565.Draw565.blit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">blit()</span></code></a> - blit an image to the display at specified (x, y)
coordinates, image type is detected automatically</p></li>
<li><p><a class="reference internal" href="wasp.html#draw565.Draw565.fill" title="draw565.Draw565.fill"><code class="xref py py-meth docutils literal notranslate"><span class="pre">fill()</span></code></a> - fill a rectangle, without arguments the default
is a black rectangle covering the entire screen which is useful to clear
the screen prior to an update</p></li>
<li><p><a class="reference internal" href="wasp.html#draw565.Draw565.string" title="draw565.Draw565.string"><code class="xref py py-meth docutils literal notranslate"><span class="pre">string()</span></code></a> - render a string, optionally centring it
automatically</p></li>
<li><p><a class="reference internal" href="wasp.html#draw565.Draw565.wrap" title="draw565.Draw565.wrap"><code class="xref py py-meth docutils literal notranslate"><span class="pre">wrap()</span></code></a> - automatically determine where to break a string
so it can be rendered to a specified width</p></li>
</ul>
<p>Most applications run some variant of the following code from their
<a class="reference internal" href="#apps.template.TemplateApp.foreground" title="apps.template.TemplateApp.foreground"><code class="xref py py-meth docutils literal notranslate"><span class="pre">foreground()</span></code></a> or <a class="reference internal" href="#apps.template.TemplateApp._draw" title="apps.template.TemplateApp._draw"><code class="xref py py-meth docutils literal notranslate"><span class="pre">_draw()</span></code></a> methods
in order to clear the display ready for a redraw.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">draw</span> <span class="o">=</span> <span class="n">wasp</span><span class="o">.</span><span class="n">watch</span><span class="o">.</span><span class="n">drawable</span>
<span class="n">draw</span><span class="o">.</span><span class="n">fill</span><span class="p">()</span>
<span class="c1"># now use draw to render the rest of the screen</span>
</pre></div>
</div>
<p>Some applications customize the above code slightly if they require a custom
background colour and it may even be omitted entirely if the application
explicitly draws every pixel on the display.</p>
<p>Finally, wasp-os provides a small number of widgets that allow common fragments
of logic and redrawing code to be shared between applications:</p>
<ul class="simple">
<li><p><a class="reference internal" href="wasp.html#widgets.BatteryMeter" title="widgets.BatteryMeter"><code class="xref py py-class docutils literal notranslate"><span class="pre">BatteryMeter</span></code></a></p></li>
<li><p><code class="xref py py-class docutils literal notranslate"><span class="pre">ScrollingIndicator</span></code></p></li>
</ul>
</div>
<div class="section" id="micropython">
<h3><a class="toc-backref" href="#id11">MicroPython</a><a class="headerlink" href="#micropython" title="Permalink to this headline">¶</a></h3>
<p>Many of the features of wasp-os are inherited directly from <a class="reference external" href="https://micropython.org/">MicroPython</a>. It is
useful to have a basic understanding of MicroPython and, in particular, put
in a little time learning the best ways to copy with running
<a class="reference external" href="http://docs.micropython.org/en/latest/reference/constrained.html">MicroPython on microcontrollers</a>.</p>
</div>
</div>
<div class="section" id="how-to-run-your-application">
<h2><a class="toc-backref" href="#id12">How to run your application</a><a class="headerlink" href="#how-to-run-your-application" title="Permalink to this headline">¶</a></h2>
<div class="section" id="testing-on-the-simulator">
<h3><a class="toc-backref" href="#id13">Testing on the simulator</a><a class="headerlink" href="#testing-on-the-simulator" title="Permalink to this headline">¶</a></h3>
<p>wasp-os provides a simulator that can be used to test applications before
downloading them to the device. The simulator is useful for ensuring the
code is syntactically correct and that there are not major runtime problems
(e.g. missing symbols).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The simulator does not model the RAM or code size limits of the real
device. It may still be necessary to tune the application for minimal
footprint after testing on the simulator.</p>
</div>
<p>Firstly launch the simulator:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sh$ make sim
<span class="nv">PYTHONDONTWRITEBYTECODE</span><span class="o">=</span><span class="m">1</span> <span class="nv">PYTHONPATH</span><span class="o">=</span>.:wasp/boards/simulator:wasp <span class="se">\\</span>
python3 -i wasp/main.py
MOTOR: <span class="nb">set</span> on
BACKLIGHT: <span class="m">2</span>
Watch is running, use Ctrl-C to stop
</pre></div>
</div>
<p>From the simulator console we can register the application with the following
code:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span> <span class="o">^</span><span class="n">C</span>
 <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
 <span class="o">...</span>
 <span class="ne">KeyboardInterrupt</span>
 <span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">myapp</span> <span class="kn">import</span> <span class="n">MyApp</span>
 <span class="o">&gt;&gt;&gt;</span> <span class="n">wasp</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">MyApp</span><span class="p">())</span>
 <span class="o">&gt;&gt;&gt;</span> <span class="n">wasp</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
 <span class="n">Watch</span> <span class="ow">is</span> <span class="n">running</span><span class="p">,</span> <span class="n">use</span> <span class="n">Ctrl</span><span class="o">-</span><span class="n">C</span> <span class="n">to</span> <span class="n">stop</span>
</pre></div>
</td></tr></table></div>
<p>When an application is registered it does not start automatically but it will
have been added to the launcher and you will be able to select in the simulator
by using the Arrow keys to bring up the launcher and then clicking on your
application.</p>
<p>The application can also be registered automatically when you load the
simulator if you add it to <code class="docutils literal notranslate"><span class="pre">wasp/main.py</span></code>. Try adding lines 5 and 6 from
the above example into this file (between <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">wasp</span></code> and
<code class="docutils literal notranslate"><span class="pre">wasp.system.run()</span></code>).</p>
</div>
<div class="section" id="testing-on-the-device">
<h3><a class="toc-backref" href="#id14">Testing on the device</a><a class="headerlink" href="#testing-on-the-device" title="Permalink to this headline">¶</a></h3>
<p>If we have an application under development when we can launch a quick test
that does not result in the application being permanently stored on the device.
Providing there is enough available RAM then this can lead to a very quick
edit-test cycles.</p>
<p>Try:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sh$ tools/wasptool <span class="se">\\</span>
        --exec myapp.py <span class="se">\\</span>
        --eval <span class="s2">&quot;wasp.system.register(MyApp())&quot;</span>
Preparing to run myapp.py:
<span class="o">[</span><span class="c1">##################################################] 100%</span>
</pre></div>
</div>
<p>Like the simulator, when an application is registered it does not start
automatically but it will have been added to the launcher and can be launched
using the normal gestures to control the device.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the progress bar jams at the same point each time then it is likely your
application is too large to be compiled on the target. You may have to
adopt the frozen module approach from the next section.</p>
</div>
</div>
<div class="section" id="making-it-permanent">
<h3><a class="toc-backref" href="#id15">Making it permanent</a><a class="headerlink" href="#making-it-permanent" title="Permalink to this headline">¶</a></h3>
<p>To ensure you application survives a system reset (press the hardware
button for around five seconds until the splash screen is seen, wait
five seconds and then press again) then we must copy it to the device
and ensure it gets launched during system startup.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Applications stored in external FLASH have a greater RAM overhead than
applications that are frozen into the wasp-os binary. See next section for
additional details.</p>
</div>
<p>To copy your application to the external FLASH try:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sh$ ./tools/wasptool --upload myapp.py
Uploading myapp.py:
<span class="o">[</span><span class="c1">##################################################] 100%</span>
</pre></div>
</div>
<p>At this point your application is stored on the external FLASH but it will
not automatically be loaded. This requires you to update the <code class="docutils literal notranslate"><span class="pre">main.py</span></code> file
stored in the external FLASH. When wasp-os runs for the first time it
automatically generates this file (using <code class="docutils literal notranslate"><span class="pre">wasp/main.py</span></code> as a template)
and copies it to the external FLASH. After this point <code class="docutils literal notranslate"><span class="pre">main.py</span></code> is user
modifiable and can be used to tweak the configuration of the watch before
it starts running.</p>
<p>Edit <code class="docutils literal notranslate"><span class="pre">wasp/main.py</span></code> to add the following two lines between <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">wasp</span></code>
and the <code class="docutils literal notranslate"><span class="pre">wasp.system.run()</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">myapp</span> <span class="kn">import</span> <span class="n">MyApp</span>
<span class="n">wasp</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">MyApp</span><span class="p">())</span>
</pre></div>
</div>
<p>Having done that we can use <code class="docutils literal notranslate"><span class="pre">wasptool</span></code> to upload the modified file
to the watch:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sh$ ./tools/wasptool --upload wasp/main.py
Uploading wasp/main.py:
<span class="o">[</span><span class="c1">##################################################] 100%</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the new code on the watch throws an exception (including an
out-of-memory exception) then your watch will display a black screen at
startup. If that happens, and you don’t know how to debug the problem, then
you can use wasptool to restore the original version of main.py .</p>
</div>
</div>
<div class="section" id="freezing-your-application-into-the-wasp-os-binary">
<h3><a class="toc-backref" href="#id16">Freezing your application into the wasp-os binary</a><a class="headerlink" href="#freezing-your-application-into-the-wasp-os-binary" title="Permalink to this headline">¶</a></h3>
<p>Freezing your application causes it to consume dramatically less RAM.  That is
because the code is both pre-compiled (meaning we don’t need any RAM budget to
run the compiler) <strong>and</strong> it can execute directly from the internal FLASH
memory.</p>
<p>Freezing your application simply requires you to modify the <code class="docutils literal notranslate"><span class="pre">manifest.py</span></code>
file for your board (e.g. <code class="docutils literal notranslate"><span class="pre">wasp/boards/pinetime/manifest.py</span></code>) to include
your application and then the whole binary must be re-compiled as normal.</p>
<p>After that you an use the same technique described in the previous
section to add an import and register for you application to <code class="docutils literal notranslate"><span class="pre">main.py</span></code></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The micropython import path “prefers” frozen modules to those found in the
external filesystem. If your application is both frozen and copied to
external FLASH then the frozen version will be loaded.</p>
<p>In many cases it is possible to avoid rebuilding the binary in order to
test new features by parsing the code in the global namespace and then
patching it into the existing code. For example the following can be used
to adopt a new version of the CST816S driver:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>./tools/wasptool\
    --exec wasp/drivers/cst816s.py\
    --eval &quot;watch.touch = CST816S(watch.i2c)&quot;`
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="application-entry-points">
<h2><a class="toc-backref" href="#id17">Application entry points</a><a class="headerlink" href="#application-entry-points" title="Permalink to this headline">¶</a></h2>
<p>Applications provide entry points for the system manager to use to notify
the application of a change in system state or an user interface event.</p>
<span class="target" id="module-apps.template"></span><p>The complete set of wasp-os application entry points are documented
below as part of a template application. Note that the template does
not rely on any specific parent class. This is because applications in
wasp-os can rely on <em>duck typing</em> making a class hierarchy pointless.</p>
<dl class="class">
<dt id="apps.template.TemplateApp">
<em class="property">class </em><code class="sig-prename descclassname">apps.template.</code><code class="sig-name descname">TemplateApp</code><a class="headerlink" href="#apps.template.TemplateApp" title="Permalink to this definition">¶</a></dt>
<dd><p>Template application.</p>
<p>The template application includes every application entry point. It
is used as a reference guide and can also be used as a template for
creating new applications.</p>
<dl class="data">
<dt>
<code class="sig-name descname">NAME = 'Template'</code></dt>
<dd><p>Applications must provide a short <code class="docutils literal notranslate"><span class="pre">NAME</span></code> that is used by the
launcher to describe the application. Names that are longer than
8 characters are likely to be abridged by the launcher in order
to fit on the screen.</p>
</dd></dl>

<dl class="data">
<dt>
<code class="sig-name descname">ICON = RLE2DATA</code></dt>
<dd><p>Applications can optionally provide an icon for display by the
launcher. Applications that expect to be installed on the quick
ring will not be listed by the launcher and need not provide any
icon. When no icon is provided the system will use a default
icon.</p>
<p>The icon is an opportunity to differentiate your application from others
so supplying an icon is strongly recommended. The icon, when provided,
must not be larger than 96x64.</p>
</dd></dl>

<dl class="method">
<dt id="apps.template.TemplateApp.__init__">
<code class="sig-name descname">__init__</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#apps.template.TemplateApp.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>Initialize the application.</p>
</dd></dl>

<dl class="attribute">
<dt id="apps.template.TemplateApp.__weakref__">
<code class="sig-name descname">__weakref__</code><a class="headerlink" href="#apps.template.TemplateApp.__weakref__" title="Permalink to this definition">¶</a></dt>
<dd><p>list of weak references to the object (if defined)</p>
</dd></dl>

<dl class="method">
<dt id="apps.template.TemplateApp._draw">
<code class="sig-name descname">_draw</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#apps.template.TemplateApp._draw" title="Permalink to this definition">¶</a></dt>
<dd><p>Draw the display from scratch.</p>
</dd></dl>

<dl class="method">
<dt id="apps.template.TemplateApp._update">
<code class="sig-name descname">_update</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#apps.template.TemplateApp._update" title="Permalink to this definition">¶</a></dt>
<dd><p>Update the dynamic parts of the application display.</p>
</dd></dl>

<dl class="method">
<dt id="apps.template.TemplateApp.background">
<code class="sig-name descname">background</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#apps.template.TemplateApp.background" title="Permalink to this definition">¶</a></dt>
<dd><p>De-activate the application.</p>
</dd></dl>

<dl class="method">
<dt id="apps.template.TemplateApp.foreground">
<code class="sig-name descname">foreground</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#apps.template.TemplateApp.foreground" title="Permalink to this definition">¶</a></dt>
<dd><p>Activate the application.</p>
</dd></dl>

<dl class="method">
<dt id="apps.template.TemplateApp.press">
<code class="sig-name descname">press</code><span class="sig-paren">(</span><em class="sig-param">button</em>, <em class="sig-param">state</em><span class="sig-paren">)</span><a class="headerlink" href="#apps.template.TemplateApp.press" title="Permalink to this definition">¶</a></dt>
<dd><p>Notify the application of a button-press event.</p>
</dd></dl>

<dl class="method">
<dt id="apps.template.TemplateApp.sleep">
<code class="sig-name descname">sleep</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#apps.template.TemplateApp.sleep" title="Permalink to this definition">¶</a></dt>
<dd><p>Notify the application the device is about to sleep.</p>
</dd></dl>

<dl class="method">
<dt id="apps.template.TemplateApp.swipe">
<code class="sig-name descname">swipe</code><span class="sig-paren">(</span><em class="sig-param">event</em><span class="sig-paren">)</span><a class="headerlink" href="#apps.template.TemplateApp.swipe" title="Permalink to this definition">¶</a></dt>
<dd><p>Notify the application of a touchscreen swipe event.</p>
</dd></dl>

<dl class="method">
<dt id="apps.template.TemplateApp.tick">
<code class="sig-name descname">tick</code><span class="sig-paren">(</span><em class="sig-param">ticks</em><span class="sig-paren">)</span><a class="headerlink" href="#apps.template.TemplateApp.tick" title="Permalink to this definition">¶</a></dt>
<dd><p>Notify the application that its periodic tick is due.</p>
</dd></dl>

<dl class="method">
<dt id="apps.template.TemplateApp.touch">
<code class="sig-name descname">touch</code><span class="sig-paren">(</span><em class="sig-param">event</em><span class="sig-paren">)</span><a class="headerlink" href="#apps.template.TemplateApp.touch" title="Permalink to this definition">¶</a></dt>
<dd><p>Notify the application of a touchscreen touch event.</p>
</dd></dl>

<dl class="method">
<dt id="apps.template.TemplateApp.wake">
<code class="sig-name descname">wake</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#apps.template.TemplateApp.wake" title="Permalink to this definition">¶</a></dt>
<dd><p>Notify the application the device is waking up.</p>
</dd></dl>

</dd></dl>

</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">WASP-OS</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="README.html">Watch Application System in Python</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Application Writer’s Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#application-life-cycle">Application life-cycle</a></li>
<li class="toctree-l2"><a class="reference internal" href="#api-primer">API primer</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-to-run-your-application">How to run your application</a></li>
<li class="toctree-l2"><a class="reference internal" href="#application-entry-points">Application entry points</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="wasp.html">Wasp-os Reference Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="TODO.html">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">Licensing</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="README.html" title="previous chapter">Watch Application System in Python</a></li>
      <li>Next: <a href="wasp.html" title="next chapter">Wasp-os Reference Manual</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Daniel Thompson.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.2.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/appguide.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>